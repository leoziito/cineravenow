<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CineRave - Watch Together</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: { 900: '#050505', 800: '#0a0a0a', 700: '#121212', card: '#1a1a1a', input: '#222222', chat: '#262626' },
                        brand: { glow: 'rgba(255, 255, 255, 0.15)', accent: '#ffffff', silver: '#cccccc', gold: '#FFD700', danger: '#ef4444', success: '#10b981', premium: '#EAB308', verified: '#3b82f6' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'], logo: ['Montserrat', 'sans-serif'] },
                    animation: { 'spin-slow': 'spin 3s linear infinite', 'slide-in': 'slideIn 0.3s ease-out forwards', 'fade-out': 'fadeOut 0.3s ease-in forwards', 'fade-in': 'fadeIn 0.4s ease-out', 'scale-up': 'scaleUp 0.2s ease-out', 'pulse-gold': 'pulseGold 2s infinite' },
                    keyframes: {
                        slideIn: { '0%': { transform: 'translateY(-20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        fadeOut: { '0%': { opacity: '1' }, '100%': { opacity: '0' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        scaleUp: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        pulseGold: { '0%, 100%': { boxShadow: '0 0 0 0 rgba(234, 179, 8, 0.4)' }, '50%': { boxShadow: '0 0 0 10px rgba(234, 179, 8, 0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050505; color: #e5e5e5; -webkit-tap-highlight-color: transparent; overflow-x: hidden; overflow-y: scroll; overscroll-behavior-y: none; }
        ::-webkit-scrollbar { width: 0px; height: 0px; background: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .cinerave-logo { font-family: 'Montserrat', sans-serif; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; user-select: none; background: linear-gradient(180deg, #ffffff 0%, #e0e0e0 45%, #a0a0a0 50%, #d0d0d0 55%, #ffffff 100%); background-size: 200% auto; -webkit-background-clip: text; background-clip: text; color: transparent; filter: drop-shadow(0px 0px 8px rgba(255, 255, 255, 0.2)); animation: shine 5s linear infinite; }
        @keyframes shine { to { background-position: 200% center; } }
        .bottom-nav { background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-top: none; padding-bottom: env(safe-area-inset-bottom); transition: all 0.3s ease; z-index: 60; }
        .nav-item { position: relative; transition: all 0.3s ease; color: #444; transform: scale(0.9); }
        .nav-item.active { color: #ffffff; text-shadow: 0 0 12px rgba(255,255,255,0.5); transform: scale(1.1); }
        .nav-item.active::after { content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; border-radius: 50%; background-color: #ffffff; box-shadow: 0 0 8px #ffffff; }
        .nav-item.admin-btn { color: #888; }
        .nav-item.admin-btn.active { color: #ff3b3b; text-shadow: 0 0 12px rgba(255, 59, 59, 0.5); }
        .nav-item.admin-btn.active::after { background-color: #ff3b3b; box-shadow: 0 0 8px #ff3b3b; }
        header { transition: background 0.4s ease, backdrop-filter 0.4s ease, padding 0.3s ease; z-index: 50; }
        header.scrolled { background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.05); padding-top: max(10px, env(safe-area-inset-top)); padding-bottom: 10px; }
        .content-section { display: none; padding-bottom: 120px; min-height: 100vh; animation: fadeIn 0.4s ease-out; }
        .content-section.active { display: block; }
        #search, #profile, #admin, #mylist, #premium { padding-top: 100px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        #hero-slider { position: relative; width: 100%; height: 65vh; overflow: hidden; }
        .hero-slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center top; opacity: 0; transition: opacity 0.8s ease-in-out; }
        .hero-slide.active { opacity: 1; }
        .hero-gradient { position: absolute; inset: 0; background: linear-gradient(to top, #050505 0%, rgba(5, 5, 5, 0.8) 15%, rgba(5, 5, 5, 0.4) 40%, rgba(5, 5, 5, 0) 100%); display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 40px; text-align: center; z-index: 10; }
        #details-page { z-index: 55; }
        .details-hero { position: relative; height: 50vh; width: 100%; mask-image: linear-gradient(to bottom, black 60%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 60%, transparent 100%); }
        .details-poster-shadow { box-shadow: 0 10px 40px -10px rgba(0,0,0,0.8); }
        .synopsis-clamp { display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
        .synopsis-clamp.expanded { -webkit-line-clamp: unset; }
        .episode-card { display: flex; gap: 12px; align-items: center; padding: 10px; border-radius: 8px; transition: background 0.2s; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .episode-card:active { background: rgba(255,255,255,0.05); }
        .episode-thumb { width: 120px; aspect-ratio: 16/9; object-fit: cover; border-radius: 6px; background: #1a1a1a; flex-shrink: 0; }
        .carousel-container { display: flex; gap: 12px; overflow-x: auto; padding-left: 16px; padding-right: 16px; scroll-snap-type: x mandatory; padding-bottom: 20px; }
        .carousel-item { flex: 0 0 110px; scroll-snap-align: start; position: relative; transition: transform 0.2s; cursor: pointer; }
        .carousel-item.wide-item { flex: 0 0 220px; }
        .carousel-item:active { transform: scale(0.95); }
        .carousel-poster { width: 100%; height: 160px; border-radius: 8px; object-fit: cover; background: #1a1a1a; }
        .carousel-thumb { width: 100%; height: 125px; border-radius: 8px; object-fit: cover; background: #1a1a1a; }
        #search-results-grid, #view-more-grid, #live-channels-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 0 16px 100px 16px; }
        #view-more-grid h4 { display: none; }
        #mylist-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 0 16px 100px 16px; }
        .search-item-poster, .grid-item-poster { width: 100%; aspect-ratio: 2/3; border-radius: 6px; object-fit: cover; background: #1a1a1a; cursor: pointer; }
        .badge-container { position: absolute; top: 4px; left: 4px; display: flex; flex-direction: column; gap: 4px; align-items: flex-start; z-index: 5; pointer-events: none; }
        .content-badge { font-size: 8px; font-weight: 800; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; box-shadow: 0 2px 4px rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .badge-4k { background: rgba(0,0,0,0.8); border: 1px solid #EAB308; color: #EAB308; }
        .badge-drive { background: #16a34a; color: white; }
        .badge-telegram { background: #3b82f6; color: white; }
        .badge-new { background: #ef4444; color: white; }
        .badge-sub { background: rgba(255,255,255,0.2); border: 1px solid white; color: white; }
        .badge-soon { background: #000; border: 1px solid #666; color: #ccc; }
        .badge-episode { position: absolute; bottom: 6px; right: 6px; background: rgba(0,0,0,0.8); color: white; font-size: 9px; font-weight: bold; padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); }
        #player-page { position: fixed; inset: 0; z-index: 100; background: #000; display: none; flex-direction: column; }
        #player-page.active { display: flex; }
        .video-container { position: relative; width: 100%; max-width: 1000px; margin: 0 auto; aspect-ratio: 16/9; background: #000; display: flex; align-items: center; justify-content: center; }
        .video-controls { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); padding: 20px 10px 10px 10px; opacity: 0; transition: opacity 0.3s; display: flex; flex-direction: column; gap: 8px; }
        .video-container:hover .video-controls, .video-container.paused .video-controls { opacity: 1; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 12px; width: 12px; border-radius: 50%; background: #8b5cf6; margin-top: -4px; box-shadow: 0 0 10px rgba(139,92,246,0.5); }
        .filter-chip { white-space: nowrap; padding: 6px 16px; border-radius: 99px; font-size: 11px; font-weight: 600; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #aaa; transition: all 0.2s; }
        .filter-chip.active { background: #fff; color: #000; border-color: #fff; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(10px); z-index: 100; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-overlay.active { display: flex; animation: fadeIn 0.2s ease; }
        .glass-panel { background: #121212; border: 1px solid rgba(255, 255, 255, 0.05); box-shadow: 0 0 40px rgba(0, 0, 0, 0.8); border-radius: 24px; }
        .custom-input { background-color: #1a1a1a; border: 1px solid #333; color: white; transition: all 0.3s; }
        .custom-input:focus { border-color: #fff; outline: none; box-shadow: 0 0 0 1px rgba(255,255,255,0.2); }
        .tag-select { cursor: pointer; border: 1px solid #333; transition: all 0.2s; }
        .tag-select.selected { background-color: #fff; color: #000; font-weight: bold; border-color: #fff; }
        .btn-loading { opacity: 0.7; pointer-events: none; }
        .copy-feedback { position: absolute; top: -35px; left: 50%; transform: translateX(-50%) scale(0.9); background: #fff; color: #000; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: bold; opacity: 0; transition: all 0.2s; pointer-events: none; white-space: nowrap; box-shadow: 0 4px 12px rgba(0,0,0,0.5); }
        .copy-feedback.show { opacity: 1; transform: translateX(-50%) scale(1); top: -45px; }
        .copy-feedback::after { content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%) rotate(45deg); width: 8px; height: 8px; background: #fff; }
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; width: 90%; max-width: 400px; }
        .toast { pointer-events: auto; background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); color: white; padding: 12px 16px; border-radius: 12px; display: flex; align-items: center; gap: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); font-size: 13px; }
        .toast.success { border-left: 3px solid #10b981; }
        .toast.error { border-left: 3px solid #ef4444; }
        .toast.info { border-left: 3px solid #3b82f6; }
        .server-option { display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; padding: 12px 16px; border-radius: 12px; margin-bottom: 8px; border: 1px solid rgba(255,255,255,0.05); transition: all 0.2s; }
        .server-option:not(.disabled):hover { background: #222; transform: translateX(2px); border-color: rgba(255,255,255,0.2); }
        .server-option.disabled { opacity: 0.5; pointer-events: none; filter: grayscale(1); position: relative; }
        .server-option.disabled::after { content: '\f023'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; right: 15px; color: #666; font-size: 14px; }
        .server-logo { width: 24px; height: 24px; object-fit: contain; }
        .premium-card { background: linear-gradient(145deg, #1a1a1a, #111); border: 1px solid rgba(255,255,255,0.05); border-radius: 20px; padding: 20px; position: relative; overflow: hidden; }
        .premium-card.featured { border: 1px solid rgba(234, 179, 8, 0.5); box-shadow: 0 0 30px rgba(234, 179, 8, 0.1); }
        .premium-badge { position: absolute; top: 12px; right: 12px; background: #EAB308; color: black; font-weight: bold; font-size: 10px; padding: 4px 8px; border-radius: 99px; }
        .price-strike { text-decoration: line-through; color: #666; font-size: 12px; }
        .lock-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 20; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 24px; }
        .verified-badge { width: 16px; height: 16px; margin-left: 4px; display: inline-block; vertical-align: middle; }
        .chat-msg { max-width: 80%; padding: 10px 14px; border-radius: 14px; margin-bottom: 8px; font-size: 13px; line-height: 1.4; position: relative; word-wrap: break-word; }
        .chat-msg.mine { background: #3b82f6; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .chat-msg.other { background: #262626; color: #e5e5e5; align-self: flex-start; border-bottom-left-radius: 2px; border: 1px solid rgba(255,255,255,0.1); }
        .notification-badge { position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; width: 18px; height: 18px; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid #121212; }
        .next-ep-btn { position: absolute; bottom: 80px; right: 20px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(5px); color: white; padding: 10px 20px; border-radius: 8px; font-weight: bold; display: none; align-items: center; gap: 8px; cursor: pointer; transition: all 0.3s; }
        .next-ep-btn:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <header id="main-header" class="fixed top-0 w-full z-50 bg-gradient-to-b from-dark-900 via-dark-900/60 to-transparent select-none transition-all duration-300 flex justify-between items-start px-6 pt-6 pb-4" style="padding-top: max(20px, env(safe-area-inset-top));">
        <div class="w-8"></div> 
        <h1 id="brand-logo" class="cinerave-logo text-3xl md:text-4xl" onclick="handleLogoTap()">CINERAVE</h1>
        <div class="w-8 flex justify-end">
            <button id="header-mylist-btn" onclick="switchTab('mylist')" class="hidden text-white/80 hover:text-white transition">
                <i class="fa-solid fa-bookmark text-xl"></i>
            </button>
        </div>
    </header>

    <main id="app-container" class="relative w-full md:max-w-xl md:mx-auto">

        <section id="home" class="content-section active">
             <div id="hero-slider" class="mb-6 bg-dark-900"><div class="flex h-full items-center justify-center text-gray-600"><i class="fa-solid fa-circle-notch fa-spin text-2xl"></i></div></div>
             <div id="carousels-area" class="space-y-8 pb-10"></div>
        </section>

        <section id="mylist" class="content-section">
            <div class="px-4">
                <h2 class="text-lg font-bold text-white uppercase tracking-wider mb-6 border-b border-white/10 pb-4">Minha Lista</h2>
                <div id="mylist-grid"></div>
                <div id="mylist-empty" class="hidden flex-col items-center justify-center py-20 text-center text-gray-500">
                    <i class="fa-regular fa-bookmark text-3xl mb-2"></i>
                    <p class="text-xs">Sua lista está vazia.</p>
                </div>
            </div>
        </section>

        <section id="premium" class="content-section">
            <div class="px-4 pb-20">
                <div class="text-center mb-8">
                    <i class="fa-solid fa-crown text-4xl text-yellow-500 mb-3 animate-pulse-gold rounded-full p-2"></i>
                    <h2 class="text-2xl font-black text-white uppercase mb-2">Seja Premium</h2>
                    <p class="text-gray-400 text-xs px-6">Desbloqueie todo o potencial do CineRave e apoie nosso projeto.</p>
                </div>
                <div class="space-y-4 mb-8">
                    <div class="premium-card featured">
                        <span class="premium-badge">MELHOR ESCOLHA</span>
                        <h3 class="text-lg font-bold text-white">Vitalício</h3>
                        <div class="flex items-end gap-2 mt-1 mb-3">
                            <span id="price-vitalicio" class="text-3xl font-black text-yellow-500">R$ 50,00</span>
                            <span id="price-old-vitalicio" class="price-strike mb-1 hidden">R$ 50,00</span>
                            <span class="text-xs text-gray-400 mb-1">/único</span>
                        </div>
                        <p id="promo-text" class="text-[10px] text-green-400 font-bold mb-4 hidden"><i class="fa-solid fa-clock"></i> PROMOÇÃO DE FIM DE SEMANA!</p>
                        <a href="https://chat.whatsapp.com/GZUcD7DW8xx1mA7FbuzHT0?mode=gi_t" target="_blank" class="block w-full py-3 rounded-xl bg-yellow-500 text-black font-bold text-center text-sm hover:bg-yellow-400 transition">QUERO VITALÍCIO</a>
                    </div>
                    <div class="premium-card">
                        <h3 class="text-md font-bold text-white">5 Meses</h3>
                        <div class="flex items-end gap-2 mt-1 mb-3"><span class="text-2xl font-bold text-white">R$ 35,00</span></div>
                        <a href="https://chat.whatsapp.com/GZUcD7DW8xx1mA7FbuzHT0?mode=gi_t" target="_blank" class="block w-full py-3 rounded-xl bg-white/10 text-white font-bold text-center text-sm hover:bg-white/20 transition">ASSINAR 5 MESES</a>
                    </div>
                    <div class="premium-card">
                        <h3 class="text-md font-bold text-white">Básico (1 Mês)</h3>
                        <div class="flex items-end gap-2 mt-1 mb-3"><span class="text-2xl font-bold text-white">R$ 25,00</span></div>
                        <a href="https://chat.whatsapp.com/GZUcD7DW8xx1mA7FbuzHT0?mode=gi_t" target="_blank" class="block w-full py-3 rounded-xl bg-white/10 text-white font-bold text-center text-sm hover:bg-white/20 transition">ASSINAR MENSAL</a>
                    </div>
                    <div class="premium-card">
                        <h3 class="text-md font-bold text-white">Iniciante (10 dias)</h3>
                        <div class="flex items-end gap-2 mt-1 mb-3"><span class="text-2xl font-bold text-white">R$ 5,00</span></div>
                        <a href="https://chat.whatsapp.com/GZUcD7DW8xx1mA7FbuzHT0?mode=gi_t" target="_blank" class="block w-full py-3 rounded-xl bg-white/10 text-white font-bold text-center text-sm hover:bg-white/20 transition">TESTAR AGORA</a>
                    </div>
                </div>
                <div class="bg-dark-card rounded-2xl p-6 border border-white/5">
                    <h4 class="text-sm font-bold text-white uppercase mb-4">Vantagens Premium</h4>
                    <ul class="space-y-3 text-xs text-gray-300">
                        <li class="flex items-center gap-3"><i class="fa-solid fa-check text-green-500"></i> Catálogo Exclusivo (Drive, Telegram)</li>
                        <li class="flex items-center gap-3"><i class="fa-solid fa-check text-green-500"></i> Filmes diretos do cinema</li>
                        <li class="flex items-center gap-3"><i class="fa-solid fa-check text-green-500"></i> Qualidade 4K Liberada</li>
                        <li class="flex items-center gap-3"><i class="fa-solid fa-check text-green-500"></i> Acesso antecipado (Vitalício)</li>
                        <li class="flex items-center gap-3"><i class="fa-solid fa-check text-green-500"></i> Suporte 24h</li>
                        <li class="flex items-center gap-3"><i class="fa-solid fa-check text-green-500"></i> 5 Pedidos em até 24h</li>
                        <li class="flex items-center gap-3"><i class="fa-solid fa-check text-green-500"></i> Selo Verificado</li>
                        <li class="flex items-center gap-3"><i class="fa-solid fa-check text-green-500"></i> Troca de Nome e Foto (GIFs)</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="search" class="content-section">
             <div class="px-4 pb-24">
                <div class="sticky top-24 z-30 bg-dark-900 pb-4 pt-2">
                    <div class="flex items-center bg-dark-card border border-white/10 rounded-full px-5 py-3 shadow-lg">
                        <i class="fa-solid fa-magnifying-glass text-gray-400 mr-3"></i>
                        <input type="text" id="main-search-input" placeholder="O que você quer assistir?" class="bg-transparent border-none outline-none text-sm text-white w-full placeholder-gray-500 font-medium" onkeyup="filterSearch()">
                    </div>
                </div>
                <div class="flex gap-2 mb-4 overflow-x-auto no-scrollbar pb-1">
                    <button onclick="setSearchType('all')" class="filter-chip active type-filter" data-type="all">Todos</button>
                    <button onclick="setSearchType('movie')" class="filter-chip type-filter" data-type="movie">Filmes</button>
                    <button onclick="setSearchType('tv')" class="filter-chip type-filter" data-type="tv">Séries</button>
                    <button onclick="setSearchType('live')" class="filter-chip type-filter" data-type="live"><i class="fa-solid fa-tv mr-1"></i> Ao Vivo</button>
                </div>
                <div id="genre-container" class="flex gap-2 mb-6 overflow-x-auto no-scrollbar pb-1"></div>
                <p id="search-count" class="text-[10px] text-gray-500 uppercase font-bold mb-4 ml-1">Mostrando todos</p>
                <div id="search-results-grid"></div>
                <div id="live-channels-grid" class="hidden"></div>
                <div id="search-empty" class="hidden flex-col items-center justify-center py-10 text-center">
                    <div class="w-16 h-16 rounded-full bg-dark-card flex items-center justify-center mb-4 border border-white/5"><i class="fa-regular fa-face-sad-tear text-2xl text-gray-500"></i></div>
                    <h3 class="text-white font-bold mb-1">Ops! Não encontramos.</h3>
                    <p class="text-xs text-gray-500 mb-6 max-w-[200px]">O conteúdo que você procura ainda não está disponível.</p>
                    <a href="https://chat.whatsapp.com/Lidb3f8U9SsDe10kiLVICR?mode=gi_t" target="_blank" class="flex items-center gap-2 bg-[#25D366] text-white px-6 py-3 rounded-full font-bold text-xs hover:bg-[#128C7E] transition shadow-lg shadow-green-900/20"><i class="fa-brands fa-whatsapp text-lg"></i> FAZER PEDIDO</a>
                </div>
             </div>
        </section>

        <section id="profile" class="content-section">
            <div id="profile-logged-out" class="flex flex-col items-center justify-center h-[60vh] text-center">
                <div class="w-24 h-24 rounded-full bg-dark-card border border-white/5 flex items-center justify-center mb-8 shadow-2xl"><i class="fa-solid fa-user-astronaut text-4xl text-gray-600"></i></div>
                <h2 class="text-2xl font-bold text-white mb-2">Bem-vindo</h2>
                <p class="text-gray-500 text-sm mb-8 px-10 leading-relaxed">Faça login para criar salas, assistir com amigos e salvar seus filmes.</p>
                <button onclick="openAuthModal()" class="group relative px-10 py-4 rounded-full bg-white text-black font-bold text-sm tracking-widest hover:scale-105 transition-all shadow-[0_0_20px_rgba(255,255,255,0.1)]">ENTRAR / CRIAR</button>
            </div>
            
            <div id="profile-logged-in" class="hidden flex-col items-center pt-6 px-4">
                <div class="relative mb-3 group">
                    <div class="w-28 h-28 rounded-full p-[3px] bg-gradient-to-tr from-gray-700 via-gray-400 to-gray-700 shadow-xl" id="avatar-ring">
                        <img id="user-avatar" src="https://i.ibb.co/5k02X0f/user-placeholder.png" class="w-full h-full rounded-full object-cover bg-dark-800">
                    </div>
                    <div class="absolute bottom-1 right-1 w-6 h-6 bg-green-500 border-4 border-dark-900 rounded-full"></div>
                </div>
                
                <div class="flex items-center gap-1 mb-1 justify-center">
                    <h2 id="user-name" class="text-2xl font-black text-white tracking-tight">...</h2>
                    <img id="verified-badge" src="https://cdn-icons-png.flaticon.com/512/6364/6364343.png" class="hidden verified-badge" title="Verificado">
                </div>
                
                <span id="user-badge" class="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[9px] uppercase font-bold text-brand-silver mb-2 inline-block">Usuário Grátis</span>
                <p id="premium-expire-label" class="text-[10px] text-gray-500 font-mono mb-6 hidden">Expira em: <span id="expire-timer" class="text-white">--:--:--</span></p>

                <div id="premium-dashboard" class="w-full max-w-sm grid grid-cols-2 gap-3 mb-6 hidden animate-fade-in">
                    <button onclick="openEditProfile()" class="col-span-2 py-3 bg-white/5 border border-white/10 rounded-xl text-white text-xs font-bold hover:bg-white/10 flex items-center justify-center gap-2 transition"><i class="fa-solid fa-pen"></i> Editar Perfil (Nome/Foto/GIF)</button>
                    <a href="https://whatsapp.com/channel/0029Vb75wR1It5rrGsBRHI1u" target="_blank" class="py-3 bg-[#25D366]/10 border border-[#25D366]/20 rounded-xl text-[#25D366] text-[10px] font-bold hover:bg-[#25D366]/20 flex flex-col items-center justify-center gap-1 transition"><i class="fa-brands fa-whatsapp text-lg"></i> Canal WhatsApp</a>
                    <a href="https://t.me/+2VngXcAjuCUzOTA5" target="_blank" class="py-3 bg-[#229ED9]/10 border border-[#229ED9]/20 rounded-xl text-[#229ED9] text-[10px] font-bold hover:bg-[#229ED9]/20 flex flex-col items-center justify-center gap-1 transition"><i class="fa-brands fa-telegram text-lg"></i> Canal Telegram</a>
                    <button id="btn-support-profile" onclick="handleSupportClick()" class="py-3 bg-white/5 border border-white/10 rounded-xl text-white text-[10px] font-bold hover:bg-white/10 flex flex-col items-center justify-center gap-1 relative"><div id="support-notify" class="hidden notification-badge">!</div><i class="fa-solid fa-headset text-lg text-brand-premium"></i> <span id="support-btn-text">Suporte 24h</span></button>
                    <button onclick="openRequestSearch()" class="py-3 bg-white/5 border border-white/10 rounded-xl text-white text-[10px] font-bold hover:bg-white/10 flex flex-col items-center justify-center gap-1"><i class="fa-solid fa-clapperboard text-lg text-brand-premium"></i> Fazer Pedido<span class="text-[8px] uppercase text-white/30" id="request-quota-label">Carregando...</span></button>
                </div>

                <div id="free-dashboard" class="w-full max-w-sm mb-6 animate-fade-in">
                     <button onclick="openRequestSearch()" class="w-full py-3 bg-white/5 border border-white/10 rounded-xl text-white text-[10px] font-bold hover:bg-white/10 flex items-center justify-center gap-2"><i class="fa-solid fa-clapperboard text-brand-silver"></i> Fazer Pedido (1/Semana)</button>
                </div>

                <button id="btn-upgrade-profile" onclick="switchTab('premium')" class="w-full max-w-xs py-3.5 mb-4 rounded-xl bg-gradient-to-r from-yellow-600 to-yellow-500 text-black font-bold text-sm hover:scale-105 transition shadow-lg shadow-yellow-500/20 flex items-center justify-center gap-2"><i class="fa-solid fa-crown"></i> FAÇA UPGRADE</button>
                <button id="btn-renew-profile" onclick="switchTab('premium')" class="hidden w-full max-w-xs py-3.5 mb-4 rounded-xl bg-red-600/20 border border-red-500 text-red-500 font-bold text-sm hover:bg-red-600/30 transition flex items-center justify-center gap-2"><i class="fa-solid fa-rotate-right"></i> RENOVAR AGORA</button>

                <div class="relative mb-8 cursor-pointer w-full max-w-xs group" onclick="copyUID()">
                    <div id="copy-feedback" class="copy-feedback">Copiado!</div>
                    <div class="flex items-center justify-between px-5 py-3 rounded-xl bg-dark-card border border-white/10 hover:bg-white/5 hover:border-white/20 transition-all">
                        <div class="flex flex-col overflow-hidden mr-4"><span class="text-[9px] text-gray-500 uppercase font-bold mb-0.5">SEU ID (UID)</span><span id="user-uid" class="text-xs font-mono text-gray-300 truncate">Carregando...</span></div>
                        <i class="fa-regular fa-copy text-white/50 group-hover:text-white transition-colors"></i>
                    </div>
                </div>
                
                <button onclick="requestLogout()" class="w-full max-w-xs py-3 rounded-xl border border-white/10 text-gray-400 hover:bg-white/5 text-xs transition-all flex items-center justify-center gap-2 cursor-pointer"><i class="fa-solid fa-right-from-bracket"></i> Sair da Conta</button>
            </div>
        </section>

        <section id="admin" class="content-section">
            <div id="admin-dashboard" class="flex flex-col items-center pt-8 px-6">
                <div class="mb-8 flex flex-col items-center text-red-500 opacity-80"><i class="fa-solid fa-shield-halved text-5xl mb-3"></i><h2 class="text-lg font-bold tracking-widest uppercase">Painel Admin</h2></div>
                <div class="w-full max-w-xs flex flex-col gap-3">
                    <button onclick="startNewPublish()" class="w-full py-4 rounded-xl bg-green-600/10 border border-green-600/30 text-green-500 font-bold text-sm hover:bg-green-600/20 transition flex items-center justify-center gap-3"><i class="fa-solid fa-plus text-lg"></i> PUBLICAR NOVO</button>
                    <button onclick="showEditList()" class="w-full py-4 rounded-xl bg-blue-600/10 border border-blue-600/30 text-blue-500 font-bold text-sm hover:bg-blue-600/20 transition flex items-center justify-center gap-3"><i class="fa-solid fa-pen-to-square text-lg"></i> GERENCIAR CONTEÚDO</button>
                    <button onclick="showReports()" class="w-full py-4 rounded-xl bg-yellow-600/10 border border-yellow-600/30 text-yellow-500 font-bold text-sm hover:bg-yellow-600/20 transition flex items-center justify-center gap-3"><i class="fa-solid fa-flag text-lg"></i> RELATÓRIOS DE ERRO</button>
                    <button onclick="showPremiumSender()" class="w-full py-4 rounded-xl bg-purple-600/10 border border-purple-600/30 text-purple-500 font-bold text-sm hover:bg-purple-600/20 transition flex items-center justify-center gap-3"><i class="fa-solid fa-crown text-lg"></i> ENVIAR PREMIUM</button>
                    <button onclick="showAdminRequests()" class="w-full py-4 rounded-xl bg-teal-600/10 border border-teal-600/30 text-teal-500 font-bold text-sm hover:bg-teal-600/20 transition flex items-center justify-center gap-3"><i class="fa-solid fa-list-check text-lg"></i> PEDIDOS PREMIUM</button>
                    <button onclick="showAdminSupportList()" class="w-full py-4 rounded-xl bg-pink-600/10 border border-pink-600/30 text-pink-500 font-bold text-sm hover:bg-pink-600/20 transition flex items-center justify-center gap-3"><i class="fa-solid fa-headset text-lg"></i> SUPORTE 24H</button>
                    <button onclick="showAdminChannels()" class="w-full py-4 rounded-xl bg-orange-600/10 border border-orange-600/30 text-orange-500 font-bold text-sm hover:bg-orange-600/20 transition flex items-center justify-center gap-3"><i class="fa-solid fa-tv text-lg"></i> GERENCIAR CANAIS</button>
                </div>
            </div>
            
            <div id="edit-list-container" class="hidden px-4 pt-4 pb-20">
                <div class="flex items-center justify-between mb-6"><button onclick="hideEditList()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i> Painel</button><h2 class="text-sm font-bold uppercase tracking-wider">Gerenciar</h2></div>
                <div class="relative mb-6"><div class="flex items-center bg-dark-card border border-white/10 rounded-xl px-4 py-3"><i class="fa-solid fa-magnifying-glass text-gray-500 mr-3"></i><input type="text" id="edit-search-input" placeholder="Buscar..." class="bg-transparent border-none outline-none text-sm text-white w-full" onkeyup="filterEditList(this.value)"></div></div>
                <div id="edit-results-grid" class="space-y-4"></div>
            </div>
            <div id="reports-container" class="hidden px-4 pt-4 pb-20">
                <div class="flex items-center justify-between mb-6"><button onclick="hideReports()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i> Painel</button><h2 class="text-sm font-bold uppercase tracking-wider">Relatórios</h2></div>
                <div id="reports-grid" class="space-y-4"></div>
            </div>
            <div id="premium-sender-container" class="hidden px-4 pt-4 pb-20">
                <div class="flex items-center justify-between mb-6"><button onclick="hidePremiumSender()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i> Painel</button><h2 class="text-sm font-bold uppercase tracking-wider text-purple-500">Enviar Premium</h2></div>
                <div class="space-y-6">
                    <div>
                        <label class="text-[10px] text-gray-500 uppercase font-bold mb-2 block">ID DO USUÁRIO (UID)</label>
                        <div class="flex gap-2"><input type="text" id="premium-uid-input" class="w-full custom-input p-3 rounded-lg text-xs font-mono" placeholder="Cole o UID aqui..."><button onclick="verifyUserForPremium()" class="bg-purple-600 text-white px-4 rounded-lg font-bold text-xs"><i class="fa-solid fa-magnifying-glass"></i></button></div>
                    </div>
                    <div id="premium-user-preview" class="hidden bg-dark-card border border-white/10 rounded-xl p-4 flex gap-4 items-center">
                        <img id="premium-preview-img" src="" class="w-12 h-12 rounded-full object-cover bg-black">
                        <div class="flex-1 overflow-hidden">
                            <h4 id="premium-preview-name" class="font-bold text-white text-sm truncate">Nome</h4>
                            <p id="premium-preview-email" class="text-[10px] text-gray-400 truncate">email@email.com</p>
                            <span id="premium-preview-status" class="text-[9px] bg-white/10 px-2 rounded text-gray-300 mt-1 inline-block">Free</span>
                        </div>
                    </div>
                    <div id="premium-options-block" class="hidden space-y-4 animate-fade-in">
                        <div>
                            <label class="text-[10px] text-gray-500 uppercase font-bold mb-2 block">Selecione o Plano</label>
                            <select id="premium-plan-select" onchange="toggleCustomTime(this.value)" class="w-full custom-input p-3 rounded-lg text-sm text-white outline-none">
                                <option value="vitalicio">Vitalício (Eterno + Verificado)</option>
                                <option value="30days">Mensal (30 Dias)</option>
                                <option value="5months">5 Meses</option>
                                <option value="1year">1 Ano</option>
                                <option value="custom">Personalizado (Tempo)</option>
                            </select>
                        </div>
                        <div id="custom-time-inputs" class="hidden p-4 bg-dark-card rounded-xl border border-white/5">
                            <label class="text-[10px] text-gray-500 uppercase font-bold mb-2 block text-center">Definir Tempo Exato</label>
                            <div class="flex gap-2">
                                <div class="flex-1"><input type="number" id="custom-days" class="w-full custom-input p-2 rounded text-center text-sm" placeholder="0" min="0"><span class="block text-[9px] text-center text-gray-500 mt-1">Dias</span></div>
                                <div class="flex-1"><input type="number" id="custom-hours" class="w-full custom-input p-2 rounded text-center text-sm" placeholder="0" min="0"><span class="block text-[9px] text-center text-gray-500 mt-1">Horas</span></div>
                                <div class="flex-1"><input type="number" id="custom-minutes" class="w-full custom-input p-2 rounded text-center text-sm" placeholder="0" min="0"><span class="block text-[9px] text-center text-gray-500 mt-1">Min</span></div>
                            </div>
                        </div>
                        <button onclick="confirmSendPremium()" id="btn-send-premium" class="w-full py-4 rounded-xl bg-purple-600 text-white font-bold text-sm hover:bg-purple-700 transition shadow-[0_0_20px_rgba(147,51,234,0.3)]">CONFIRMAR ENVIO</button>
                    </div>
                </div>
            </div>
            <div id="admin-requests-container" class="hidden px-4 pt-4 pb-20">
                <div class="flex items-center justify-between mb-6"><button onclick="hideAdminRequests()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i> Painel</button><h2 class="text-sm font-bold uppercase tracking-wider text-teal-500">Pedidos de Conteúdo</h2></div>
                <div id="admin-requests-grid" class="space-y-4"></div>
            </div>
            <div id="admin-support-container" class="hidden px-4 pt-4 pb-20">
                <div class="flex items-center justify-between mb-6"><button onclick="hideAdminSupportList()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i> Painel</button><h2 class="text-sm font-bold uppercase tracking-wider text-pink-500">Tickets de Suporte</h2></div>
                <div id="admin-support-grid" class="space-y-3"></div>
            </div>
            <div id="admin-channels-container" class="hidden px-4 pt-4 pb-20">
                <div class="flex items-center justify-between mb-6">
                    <button onclick="hideAdminChannels()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i> Painel</button>
                    <h2 class="text-sm font-bold uppercase tracking-wider text-orange-500">Canais Ao Vivo</h2>
                </div>
                <button onclick="openChannelManager()" class="w-full mb-6 py-3 rounded-xl bg-orange-600/20 border border-orange-600/30 text-orange-500 font-bold text-sm flex items-center justify-center gap-2"><i class="fa-solid fa-plus"></i> Novo Canal</button>
                <div id="admin-channels-grid" class="space-y-3"></div>
            </div>
            <div id="publish-form-container" class="hidden px-4 pt-4 pb-20">
                <div class="flex items-center justify-between mb-6"><button onclick="hidePublishForm()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-arrow-left"></i> Voltar</button><h2 id="form-title" class="text-sm font-bold uppercase tracking-wider">Nova Publicação</h2></div>
                <div id="tmdb-search-block" class="relative mb-8"><div class="flex items-center bg-dark-card border border-white/10 rounded-xl px-4 py-3 focus-within:border-white/40 transition"><i class="fa-solid fa-magnifying-glass text-gray-500 mr-3"></i><input type="text" id="tmdb-search-input" placeholder="Pesquisar no TMDB..." class="bg-transparent border-none outline-none text-sm text-white w-full" onkeyup="handleTmdbSearch(event)"><i id="tmdb-loader" class="fa-solid fa-circle-notch fa-spin text-white hidden"></i></div><div id="tmdb-results" class="absolute top-full left-0 w-full bg-dark-800 border border-white/10 rounded-xl mt-2 z-50 hidden shadow-2xl"></div></div>
                <div id="main-cms-form" class="hidden space-y-6 animate-fadeIn">
                    <div class="flex gap-4"><img id="cms-poster" src="" class="w-24 h-36 object-cover rounded-lg bg-dark-card shadow-lg"><div class="flex-1 space-y-2"><input type="text" id="cms-title" class="w-full bg-transparent border-b border-white/10 pb-1 text-lg font-bold text-white focus:border-white/50 outline-none" placeholder="Título"><div class="flex gap-2"><input type="number" id="cms-year" class="w-16 bg-transparent border-b border-white/10 pb-1 text-xs text-gray-400" placeholder="Ano"><span id="cms-type-badge" class="px-2 py-0.5 rounded bg-white/10 text-[10px] uppercase font-bold text-white">FILME</span></div><input type="text" id="cms-genres" class="w-full bg-transparent border-b border-white/10 pb-1 text-xs text-gray-400" placeholder="Gêneros"></div></div>
                    <div><label class="text-[10px] text-gray-500 uppercase font-bold mb-1 block">Sinopse</label><textarea id="cms-overview" rows="3" class="w-full custom-input rounded-lg p-3 text-xs text-gray-300"></textarea></div>
                    <input type="hidden" id="cms-backdrop"><input type="hidden" id="cms-tmdb-id"><input type="hidden" id="cms-trailer"><input type="hidden" id="cms-actors">
                    <div class="grid grid-cols-2 gap-4"><div><label class="text-[10px] text-gray-500 uppercase font-bold mb-2 block">Qualidade</label><div class="flex flex-wrap gap-2"><span onclick="toggleTag(this)" class="tag-select px-3 py-1 rounded-full text-[10px] bg-dark-card text-gray-400" data-type="quality">HD</span><span onclick="toggleTag(this)" class="tag-select px-3 py-1 rounded-full text-[10px] bg-dark-card text-gray-400" data-type="quality">4K</span><span onclick="toggleTag(this)" class="tag-select px-3 py-1 rounded-full text-[10px] bg-dark-card text-gray-400" data-type="quality">HDCAM</span></div></div><div><label class="text-[10px] text-gray-500 uppercase font-bold mb-2 block">Áudio</label><div class="flex flex-wrap gap-2"><span onclick="toggleTag(this)" class="tag-select px-3 py-1 rounded-full text-[10px] bg-dark-card text-gray-400" data-type="audio">Dublado</span><span onclick="toggleTag(this)" class="tag-select px-3 py-1 rounded-full text-[10px] bg-dark-card text-gray-400" data-type="audio">Legendado</span></div></div></div>
                    <div class="bg-dark-card p-4 rounded-xl border border-white/5 space-y-3"><div class="flex justify-between items-center"><span class="text-xs text-gray-300">Em Breve</span><input type="checkbox" id="check-coming-soon" class="accent-white w-4 h-4"></div><div class="flex justify-between items-center"><span class="text-xs text-gray-300">Drive</span><input type="checkbox" id="check-drive" class="accent-yellow-500 w-4 h-4"></div><div class="flex justify-between items-center"><span class="text-xs text-gray-300">Telegram</span><input type="checkbox" id="check-telegram" class="accent-blue-500 w-4 h-4"></div><div id="container-watch-party" class="flex justify-between items-center"><span class="text-xs text-gray-300">Watch Party</span><input type="checkbox" id="check-watch-party" class="accent-red-500 w-4 h-4"></div><div class="border-t border-white/5 pt-3 flex justify-between items-center"><span class="text-xs font-bold text-gray-400">SALVAR COMO RASCUNHO</span><input type="checkbox" id="check-draft" class="accent-gray-500 w-4 h-4"></div></div>
                    <div id="section-movie-links" class="space-y-4"><h3 class="text-xs font-bold text-white uppercase border-b border-white/10 pb-2">Links</h3><div><label class="text-[10px] text-gray-500 mb-1 block">Link Principal</label><input type="text" id="movie-main-link" class="w-full custom-input p-2 rounded text-xs" placeholder="https://..."></div><div class="flex flex-wrap gap-2"><button onclick="addMovieLinkBox('drive')" class="px-3 py-1 rounded bg-yellow-600/20 text-yellow-500 border border-yellow-500/30 text-[10px] font-bold">+ Drive</button><button onclick="addMovieLinkBox('telegram')" class="px-3 py-1 rounded bg-blue-600/20 text-blue-500 border border-blue-500/30 text-[10px] font-bold">+ Telegram</button><button onclick="addMovieLinkBox('legendado')" class="px-3 py-1 rounded bg-white/10 text-gray-300 border border-white/20 text-[10px] font-bold">+ Legendado</button><button onclick="addMovieLinkBox('rave')" class="px-3 py-1 rounded bg-red-600/20 text-red-500 border border-red-500/30 text-[10px] font-bold">+ RAVE</button></div><div id="movie-extra-links" class="space-y-2"></div></div>
                    <div id="section-series-links" class="hidden space-y-4"><h3 class="text-xs font-bold text-white uppercase border-b border-white/10 pb-2">Gerenciador de Série</h3><div class="bg-dark-card p-3 rounded-lg border border-white/5 mb-4"><div class="flex items-end gap-2"><input type="number" id="input-season-count" class="w-20 custom-input p-2 rounded text-xs" min="1" value="1" placeholder="Qtd"><button onclick="generateSeasons()" class="bg-white/10 hover:bg-white/20 text-white text-xs font-bold px-3 py-2 rounded">Gerar</button></div></div><button onclick="addSeasonManual()" class="w-full py-2 bg-white/5 border border-white/10 rounded hover:bg-white/10 text-xs text-white font-bold mb-4">+ TEMP MANUAL</button><div id="seasons-container" class="space-y-4"></div></div>
                    <div class="bg-dark-card p-4 rounded-xl border border-white/5 space-y-3"><div class="grid grid-cols-1 gap-3"><div><label class="text-[10px] text-gray-500 block mb-1">Geral</label><input type="datetime-local" id="schedule-general" class="w-full custom-input p-2 rounded text-xs text-white"></div><div><label class="text-[10px] text-yellow-500/80 block mb-1">Premium</label><input type="datetime-local" id="schedule-premium" class="w-full custom-input p-2 rounded text-xs text-white"></div></div></div>
                    <button onclick="prePublishCheck()" id="btn-publish-final" class="w-full bg-white text-black font-bold py-4 rounded-xl text-sm shadow-[0_0_20px_rgba(255,255,255,0.2)] mt-8 hover:bg-gray-200 transition">PUBLICAR CONTEÚDO</button>
                </div>
            </div>
        </section>

    </main>

    <section id="view-more-page" class="hidden min-h-screen bg-dark-900 pt-8 pb-24 px-4" style="padding-top: max(20px, env(safe-area-inset-top));">
        <div class="flex items-center gap-4 mb-6 sticky top-0 bg-dark-900 z-40 py-4 border-b border-white/5">
            <button onclick="closeViewMore()" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-white"><i class="fa-solid fa-arrow-left"></i></button>
            <h2 id="view-more-title" class="text-lg font-bold text-white uppercase tracking-wider">Título</h2>
        </div>
        <div id="view-more-grid" class="grid grid-cols-4 gap-2"></div>
    </section>

    <section id="details-page" class="hidden min-h-screen bg-dark-900 pb-20 overflow-y-auto fixed inset-0">
        <button onclick="closeDetails()" class="fixed left-4 z-50 w-10 h-10 rounded-full bg-black/50 backdrop-blur-md flex items-center justify-center text-white border border-white/10" style="top: max(16px, env(safe-area-inset-top));"><i class="fa-solid fa-arrow-left"></i></button>
        <div class="details-hero relative"><img id="detail-backdrop" src="" class="w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-dark-900 via-dark-900/60 to-transparent"></div></div>
        <div class="px-5 -mt-32 relative z-10">
            <div class="flex gap-4 mb-6 items-end">
                <img id="detail-poster" src="" class="w-28 rounded-lg details-poster-shadow border border-white/10">
                <div class="flex-1 pb-1">
                    <h1 id="detail-title" class="text-2xl font-black text-white leading-tight uppercase mb-2 drop-shadow-lg">Título</h1>
                    <div class="flex flex-wrap gap-2 mb-2"><span id="detail-year" class="px-2 py-0.5 rounded bg-white/10 text-[10px] text-gray-300 font-bold"></span><span id="detail-age" class="px-2 py-0.5 rounded bg-red-600/80 text-[10px] text-white font-bold hidden"></span><span id="detail-duration" class="px-2 py-0.5 rounded bg-white/10 text-[10px] text-gray-300 font-bold hidden"></span></div>
                    <p id="detail-genre" class="text-xs text-gray-400 font-medium line-clamp-1"></p>
                </div>
            </div>
            <div class="mb-6"><p id="detail-overview" class="text-sm text-gray-300 leading-relaxed synopsis-clamp"></p><button id="detail-read-more" onclick="toggleSynopsis()" class="text-xs font-bold text-gray-500 mt-1 hidden">Ver mais</button></div>
            <button id="btn-watch-movie" onclick="openServerModalForMovie()" class="w-full bg-white text-black font-bold py-3.5 rounded-xl text-sm mb-4 flex justify-center items-center gap-2 hover:bg-gray-200 transition shadow-lg shadow-white/5 hidden"><i class="fa-solid fa-play"></i> ASSISTIR</button>
            <div id="series-container" class="hidden mb-6">
                <div class="relative mb-4"><select id="season-selector" onchange="changeSeason(this.value)" class="w-full bg-white/10 border border-white/10 rounded-lg py-3 px-4 text-sm font-bold text-white appearance-none outline-none focus:bg-white/20 transition"></select><i class="fa-solid fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i></div>
                <div id="episodes-list" class="flex flex-col gap-2"><div class="text-center text-xs text-gray-500 py-4"><i class="fa-solid fa-circle-notch fa-spin"></i> Carregando...</div></div>
            </div>
            <div class="grid grid-cols-3 gap-2 mb-8">
                <button onclick="shareContent()" class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition"><i class="fa-solid fa-share-nodes text-xl text-white"></i><span class="text-[10px] font-medium text-gray-400">Compartilhar</span></button>
                <button onclick="toggleMyList()" class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition"><i id="detail-mylist-icon" class="fa-solid fa-plus text-xl text-white"></i><span id="detail-mylist-text" class="text-[10px] font-medium text-gray-400">Minha Lista</span></button>
                <button onclick="openReportModal()" class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition"><i class="fa-solid fa-triangle-exclamation text-xl text-red-400"></i><span class="text-[10px] font-medium text-gray-400">Reportar</span></button>
            </div>
            <div class="mb-10"><h3 class="text-xs font-bold text-white uppercase mb-3 border-l-2 border-white pl-2">Elenco</h3><div id="detail-cast" class="flex gap-4 overflow-x-auto no-scrollbar pb-2"></div></div>
            <div class="pb-10 pt-4 border-t border-white/5 text-center"><p class="text-xs text-gray-500 mb-4">Gostou do projeto? Ajude a manter online!</p><a href="https://livepix.gg/cinerave" target="_blank" class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-green-600/20 text-green-400 border border-green-600/30 text-xs font-bold hover:bg-green-600/30 transition"><i class="fa-solid fa-heart"></i> APOIE O PROJETO</a></div>
        </div>
    </section>

    <section id="player-page" class="hidden">
        <div class="relative w-full h-full bg-black flex flex-col justify-center items-center group">
            <button onclick="closePlayer()" class="absolute top-6 left-6 z-50 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white transition backdrop-blur-md"><i class="fa-solid fa-arrow-left"></i></button>
            <div class="video-container shadow-2xl">
                <video id="main-video" class="w-full h-full" onclick="togglePlay()" playsinline webkit-playsinline autoplay></video>
                <div class="video-controls">
                    <input type="range" id="video-progress" min="0" max="100" value="0" step="0.1" oninput="seekVideo()" class="w-full mb-2 accent-purple-500">
                    <div class="flex justify-between items-center px-2">
                        <div class="flex items-center gap-4"><button onclick="togglePlay()" class="text-white hover:text-purple-400 transition"><i id="play-icon" class="fa-solid fa-play text-xl"></i></button><span id="video-time" class="text-xs font-mono text-gray-300">00:00 / 00:00</span></div>
                        <button onclick="toggleFullscreen()" class="text-white hover:text-purple-400 transition"><i class="fa-solid fa-expand text-lg"></i></button>
                    </div>
                </div>
                <div id="btn-next-ep" class="next-ep-btn" onclick="playNextEpisode()"><i class="fa-solid fa-forward"></i> Próximo Episódio</div>
            </div>
            <div class="w-full max-w-4xl px-4 mt-6">
                <h2 id="player-title" class="text-xl font-bold text-white text-center mb-4 uppercase tracking-wide">Título do Conteúdo</h2>
                <div class="flex justify-center gap-6">
                    <button onclick="submitVote('like')" id="btn-like" class="flex items-center gap-2 px-6 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-green-600/20 hover:border-green-500 transition group-vote"><i class="fa-regular fa-thumbs-up text-lg group-vote-hover:text-green-500"></i><span id="count-like" class="text-sm font-bold text-gray-300">0</span></button>
                    <button onclick="submitVote('dislike')" id="btn-dislike" class="flex items-center gap-2 px-6 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-red-600/20 hover:border-red-500 transition group-vote"><i class="fa-regular fa-thumbs-down text-lg group-vote-hover:text-red-500"></i><span id="count-dislike" class="text-sm font-bold text-gray-300">0</span></button>
                </div>
            </div>
        </div>
    </section>

    <div id="server-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm p-6 relative animate-scale-up">
            <button onclick="document.getElementById('server-modal').classList.remove('active')" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h3 class="text-lg font-bold text-white mb-6 uppercase tracking-wider">Escolha um Servidor</h3>
            <div id="server-list" class="space-y-3 relative"></div>
            <div id="lock-screen" class="hidden lock-overlay">
                <i class="fa-solid fa-lock text-4xl text-white mb-3"></i>
                <h4 class="text-lg font-bold text-white mb-1">Conteúdo Agendado</h4>
                <p class="text-xs text-gray-400 mb-2">Disponível em:</p>
                <div id="lock-date" class="text-sm font-mono text-yellow-500 bg-black/50 px-3 py-1 rounded"></div>
                <p id="lock-premium-hint" class="text-[10px] text-brand-premium font-bold mt-2 uppercase animate-pulse hidden">Liberado para Premium</p>
            </div>
        </div>
    </div>

    <div id="edit-profile-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm p-6 relative">
            <button onclick="closeEditProfile()" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="text-lg font-bold text-white mb-6 uppercase tracking-wider text-center">Editar Perfil Premium</h3>
            <div class="flex flex-col items-center mb-6">
                <div class="relative w-24 h-24 group cursor-pointer mb-2">
                    <div class="w-full h-full rounded-full bg-dark-card border-2 border-brand-premium flex items-center justify-center overflow-hidden relative">
                        <img id="edit-preview-img" src="" class="absolute inset-0 w-full h-full object-cover">
                    </div>
                    <input type="file" id="edit-file" accept="image/*, image/gif" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" onchange="handleEditFileSelect(event)">
                    <div class="absolute bottom-0 right-0 bg-white text-black rounded-full p-1"><i class="fa-solid fa-camera text-xs"></i></div>
                </div>
                <p class="text-[10px] text-gray-400">Toque para alterar (JPG, PNG, GIF)</p>
            </div>
            <input type="text" id="edit-name" class="w-full custom-input p-3.5 rounded-xl text-sm mb-6" placeholder="Seu Novo Nome">
            <button onclick="saveProfileChanges()" id="btn-save-profile" class="w-full bg-brand-premium text-black font-bold py-3.5 rounded-xl text-sm shadow-lg shadow-yellow-500/20">SALVAR ALTERAÇÕES</button>
        </div>
    </div>

    <div id="request-search-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm p-6 relative flex flex-col h-[80vh]">
            <button onclick="document.getElementById('request-search-modal').classList.remove('active')" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="text-lg font-bold text-white mb-4">Novo Pedido</h3>
            <div class="relative mb-4">
                <input type="text" id="req-search-input" placeholder="Qual filme ou série?" class="w-full custom-input p-3 rounded-xl text-sm pl-10" onkeyup="handleRequestSearch(this.value)">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-3.5 text-gray-500"></i>
            </div>
            <div id="req-results" class="flex-1 overflow-y-auto space-y-2"></div>
        </div>
    </div>

    <div id="request-preview-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm p-6 relative">
            <button onclick="document.getElementById('request-preview-modal').classList.remove('active')" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="text-lg font-bold text-white mb-4">Confirmar Pedido</h3>
            <div class="flex gap-3 mb-4">
                <img id="req-prev-poster" src="" class="w-20 rounded bg-black object-cover">
                <div><h4 id="req-prev-title" class="font-bold text-white text-sm leading-tight mb-1">...</h4><p id="req-prev-overview" class="text-[10px] text-gray-400 line-clamp-3">...</p></div>
            </div>
            <textarea id="req-note" class="w-full custom-input p-3 rounded-lg text-xs h-20 mb-4" placeholder="Observação opcional (Ex: Quero dublado, 4K...)"></textarea>
            <button onclick="submitRequest()" id="btn-submit-req" class="w-full bg-green-500 text-white font-bold py-3 rounded-xl hover:bg-green-600 transition">ENVIAR PEDIDO</button>
        </div>
    </div>

    <div id="chat-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-md p-0 relative flex flex-col h-[85vh] overflow-hidden">
            <div class="p-4 border-b border-white/5 flex justify-between items-center bg-dark-900">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-brand-premium flex items-center justify-center text-black font-bold text-xs"><i class="fa-solid fa-headset"></i></div>
                    <div><h4 id="chat-title" class="font-bold text-white text-sm">Suporte 24h</h4><span class="text-[10px] text-green-400 flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"></span> Online</span></div>
                </div>
                <button onclick="closeChat()" class="text-gray-500 hover:text-white"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-dark-800 flex flex-col"></div>
            <div class="p-3 bg-dark-900 border-t border-white/5 flex gap-2">
                <input type="text" id="chat-input" class="flex-1 bg-dark-input rounded-full px-4 py-2.5 text-sm text-white outline-none border border-transparent focus:border-white/10" placeholder="Digite sua mensagem...">
                <button onclick="sendMessage()" class="w-10 h-10 rounded-full bg-brand-premium text-black flex items-center justify-center hover:scale-105 transition"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <div id="support-intro-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm p-6 relative">
            <button onclick="document.getElementById('support-intro-modal').classList.remove('active')" class="absolute top-4 right-4 text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="text-lg font-bold text-white mb-2">Suporte Premium</h3>
            <p class="text-xs text-gray-400 mb-4">Descreva seu problema para iniciar o atendimento.</p>
            <textarea id="support-intro-msg" class="w-full custom-input p-3 rounded-lg text-sm h-24 mb-4" placeholder="Como podemos ajudar?"></textarea>
            <button onclick="startSupportChat()" id="btn-start-chat" class="w-full bg-brand-premium text-black font-bold py-3 rounded-xl hover:bg-yellow-400 transition">INICIAR CHAT</button>
        </div>
    </div>

    <div id="channel-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm p-6 relative max-h-[80vh] overflow-y-auto">
            <button onclick="closeChannelManager()" class="absolute top-4 right-4 text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="text-lg font-bold text-white mb-4">Gerenciar Canal Ao Vivo</h3>
            <input type="hidden" id="channel-id">
            <input type="text" id="channel-name" class="w-full custom-input p-3 rounded-lg text-sm mb-3" placeholder="Nome do Canal">
            <input type="text" id="channel-image" class="w-full custom-input p-3 rounded-lg text-sm mb-3" placeholder="URL da Imagem">
            <div id="channel-links-container" class="space-y-2 mb-4"></div>
            <button onclick="addChannelLinkBox()" class="w-full py-2 border border-white/10 rounded text-xs text-gray-300 mb-4">+ Adicionar Link</button>
            <button onclick="saveChannel()" class="w-full bg-orange-600 text-white font-bold py-3 rounded-xl hover:bg-orange-700">SALVAR CANAL</button>
        </div>
    </div>

    <div id="report-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm p-6 relative">
            <button onclick="document.getElementById('report-modal').classList.remove('active')" class="absolute top-4 right-4 text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            <h3 class="text-lg font-bold text-white mb-4">Reportar Erro</h3>
            <div class="space-y-3 mb-4">
                <label class="flex items-center gap-3 p-3 rounded bg-white/5 border border-white/10 cursor-pointer"><input type="radio" name="report_reason" value="broken_link" class="accent-red-500"><span class="text-sm text-gray-300">Link Quebrado</span></label>
                <label class="flex items-center gap-3 p-3 rounded bg-white/5 border border-white/10 cursor-pointer"><input type="radio" name="report_reason" value="buffering" class="accent-red-500"><span class="text-sm text-gray-300">Travando Muito</span></label>
                <label class="flex items-center gap-3 p-3 rounded bg-white/5 border border-white/10 cursor-pointer"><input type="radio" name="report_reason" value="wrong_content" class="accent-red-500"><span class="text-sm text-gray-300">Conteúdo Errado</span></label>
                <label class="flex items-center gap-3 p-3 rounded bg-white/5 border border-white/10 cursor-pointer"><input type="radio" name="report_reason" value="other" class="accent-red-500"><span class="text-sm text-gray-300">Outro Problema</span></label>
            </div>
            <textarea id="report-msg" class="w-full custom-input p-3 rounded-lg text-sm h-24 mb-4" placeholder="Detalhes opcionais..."></textarea>
            <button onclick="submitReport()" id="btn-send-report" class="w-full bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200">ENVIAR RELATÓRIO</button>
        </div>
    </div>

    <div id="preview-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm p-6 relative max-h-[80vh] overflow-y-auto">
            <h3 class="text-lg font-bold text-white mb-4 border-b border-white/10 pb-2">Confirmação</h3>
            <div class="flex gap-3 mb-4"><img id="preview-modal-img" src="" class="w-16 h-24 object-cover rounded bg-dark-card"><div><h4 id="preview-modal-title" class="font-bold text-white text-sm"></h4><span id="preview-modal-type" class="text-[10px] bg-white/10 px-2 rounded text-gray-300"></span><div id="preview-modal-status" class="text-[10px] mt-1 text-green-400">PUBLICAR AGORA</div></div></div>
            <div class="space-y-2 text-xs text-gray-400 mb-6 bg-dark-card p-3 rounded"><p>Links: <span id="preview-link-count" class="text-white">0</span></p><p>Temporadas: <span id="preview-season-count" class="text-white">0</span></p><p>Agendamento: <span id="preview-schedule" class="text-white">Imediato</span></p></div>
            <div class="flex gap-3"><button onclick="closePreview()" class="flex-1 py-3 rounded-xl border border-white/10 text-gray-400 hover:text-white">Editar</button><button onclick="confirmPublish()" id="btn-confirm-publish" class="flex-1 py-3 rounded-xl bg-white text-black font-bold hover:bg-gray-200">CONFIRMAR</button></div>
        </div>
    </div>

    <div id="logout-confirm-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-xs p-6 text-center">
            <i class="fa-solid fa-right-from-bracket text-3xl text-red-500 mb-4"></i><h3 class="text-white font-bold mb-2">Sair da conta?</h3><p class="text-gray-500 text-xs mb-6">Você precisará fazer login novamente para acessar.</p>
            <div class="flex gap-3"><button onclick="document.getElementById('logout-confirm-modal').classList.remove('active')" class="flex-1 py-2 rounded bg-white/5 text-gray-300">Cancelar</button><button onclick="confirmLogout()" id="btn-confirm-logout" class="flex-1 py-2 rounded bg-red-600 text-white font-bold">Sair</button></div>
        </div>
    </div>

    <div id="delete-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-xs p-6 text-center">
            <i class="fa-solid fa-triangle-exclamation text-3xl text-red-500 mb-4"></i><h3 class="text-white font-bold mb-2">Excluir?</h3>
            <div class="flex gap-3 mt-6"><button onclick="document.getElementById('delete-modal').classList.remove('active')" class="flex-1 py-2 rounded bg-white/5 text-gray-300">Cancelar</button><button onclick="executeDelete()" id="btn-confirm-delete" class="flex-1 py-2 rounded bg-red-600 text-white font-bold">Excluir</button></div>
        </div>
    </div>

    <div id="auth-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-sm p-8 relative">
            <button onclick="closeAuthModal()" class="absolute top-5 right-5 text-gray-500 hover:text-white transition"><i class="fa-solid fa-xmark text-xl"></i></button>
            <div class="flex justify-center gap-8 mb-8 border-b border-white/10 pb-1"><button id="tab-login" onclick="toggleAuthMode('login')" class="text-white font-bold pb-3 border-b-2 border-white text-sm">ENTRAR</button><button id="tab-register" onclick="toggleAuthMode('register')" class="text-gray-500 font-medium pb-3 border-b-2 border-transparent text-sm">CRIAR CONTA</button></div>
            <form id="login-form" class="space-y-5"><div><input type="email" id="login-email" class="w-full custom-input p-3.5 rounded-xl text-sm placeholder-gray-700" placeholder="Email" required></div><div class="relative"><input type="password" id="login-pass" class="w-full custom-input p-3.5 rounded-xl text-sm placeholder-gray-700" placeholder="Senha" required></div><button type="submit" id="btn-login-submit" class="w-full bg-white text-black font-bold py-3.5 rounded-xl mt-4">ACESSAR CONTA</button></form>
            <form id="register-form" class="space-y-4 hidden"><div class="flex flex-col items-center mb-6"><div class="relative w-24 h-24 group cursor-pointer mb-2"><div id="preview-container" class="w-full h-full rounded-full bg-dark-card border-2 border-white/20 flex items-center justify-center overflow-hidden relative"><i class="fa-solid fa-camera text-2xl text-gray-500"></i><img id="preview-img" src="" class="absolute inset-0 w-full h-full object-cover hidden"></div><input type="file" id="reg-file" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" onchange="handleFileSelect(event)" required></div></div><input type="text" id="reg-name" class="w-full custom-input p-3.5 rounded-xl text-sm" placeholder="Nome" required><input type="email" id="reg-email" class="w-full custom-input p-3.5 rounded-xl text-sm" placeholder="Email" required><input type="password" id="reg-pass" class="w-full custom-input p-3.5 rounded-xl text-sm" placeholder="Senha" required><button type="submit" id="btn-register" class="w-full bg-white text-black font-bold py-3.5 rounded-xl mt-4">CRIAR PERFIL</button></form>
        </div>
    </div>

    <div id="admin-auth-modal" class="modal-overlay">
        <div class="glass-panel w-full max-w-xs p-6 relative">
            <button onclick="document.getElementById('admin-auth-modal').classList.remove('active')" class="absolute top-4 right-4 text-gray-600 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            <div class="text-center mb-6"><i class="fa-solid fa-lock text-3xl text-red-500 mb-3"></i><h3 class="text-white font-bold">Restrito</h3></div>
            <input type="password" id="admin-pass-input" class="w-full custom-input p-3 rounded-xl text-center text-lg tracking-widest mb-4" placeholder="SENHA" onkeyup="checkAdminPass(event)">
            <button onclick="verifyAdmin()" class="w-full bg-red-600 text-white font-bold py-3 rounded-xl">DESBLOQUEAR</button>
        </div>
    </div>

    <nav class="bottom-nav fixed bottom-0 left-0 w-full z-50">
        <div id="nav-container" class="flex justify-around items-center h-20 max-w-2xl mx-auto px-6">
            <button onclick="switchTab('home')" class="nav-item active flex flex-col items-center justify-center w-12 h-full" data-target="home"><i class="fa-solid fa-film text-xl mb-1"></i></button>
            <button onclick="switchTab('search')" class="nav-item flex flex-col items-center justify-center w-12 h-full" data-target="search"><i class="fa-solid fa-magnifying-glass text-xl mb-1"></i></button>
            <button onclick="switchTab('profile')" class="nav-item flex flex-col items-center justify-center w-12 h-full" data-target="profile"><i class="fa-regular fa-user text-xl mb-1"></i></button>
            <button id="nav-admin-btn" onclick="switchTab('admin')" class="nav-item admin-btn hidden flex-col items-center justify-center w-12 h-full" data-target="admin"><i class="fa-solid fa-lock text-xl mb-1"></i></button>
        </div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, collection, getDocs, deleteDoc, updateDoc, getDoc, query, where, orderBy, limit, onSnapshot, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDzQpw3mVRPM4YWfZxMg6Zg-cLdraBxF7U", authDomain: "cnrave-cf180.firebaseapp.com", projectId: "cnrave-cf180", storageBucket: "cnrave-cf180.firebasestorage.app", messagingSenderId: "632471791458", appId: "1:632471791458:web:750c3f137e0b2faaf8ee3b" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const IMGBB_API_KEY = "9a792281a6220ed358215ad0c1e4162e"; 
        const TMDB_API_KEY = "d0f7e2c414b1efff7b000ae9b681ed1b"; 

        window.selectedImageFile = null;
        window.editImageFile = null;
        window.currentUserUid = null;
        window.currentUserName = null;
        window.editingId = null;
        window.contentListCache = [];
        window.allHomeContent = []; 
        window.currentDetailItem = null;
        window.userFavorites = new Set();
        window.currentUserIsPremium = false;
        window.premiumTargetUser = null;
        window.tempRequestData = null;
        window.activeChatId = null; 
        window.chatUnsub = null;
        window.currentPlayingEpisode = null;
        window.premiumExpireDate = null;
        window.unreadSupportCount = 0;
        window.currentContentUnsub = null; 

        let logoTapCount = 0; let logoTapTimer = null;
        let selectedContentType = 'movie'; let heroInterval = null;
        let currentSearchType = 'all'; let currentGenreFilter = '';
        let premiumTimerInterval = null;
        
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const contentId = urlParams.get('content');
            if (contentId) {
                getDoc(doc(db, "content", contentId)).then(docSnap => {
                    if (docSnap.exists()) {
                        const item = { id: docSnap.id, ...docSnap.data() };
                        window.allHomeContent.push(item);
                        openDetails(contentId);
                    }
                });
            }
            checkPromoTime();
        }

        function checkPromoTime() {
            const now = new Date();
            const day = now.getDay();
            const hour = now.getHours();
            let isPromo = false;
            if (day === 5 && hour >= 5) isPromo = true;
            if (day === 6 || day === 0) isPromo = true;
            if (day === 1 && hour < 5) isPromo = true;
            if (isPromo) {
                document.getElementById('price-vitalicio').textContent = 'R$ 30,00';
                document.getElementById('price-old-vitalicio').classList.remove('hidden');
                document.getElementById('promo-text').classList.remove('hidden');
            } else {
                document.getElementById('price-vitalicio').textContent = 'R$ 50,00';
                document.getElementById('price-old-vitalicio').classList.add('hidden');
                document.getElementById('promo-text').classList.add('hidden');
            }
        }

        window.addEventListener('scroll', () => {
            const header = document.getElementById('main-header');
            if (window.scrollY > 50) header.classList.add('scrolled'); else header.classList.remove('scrolled');
        });

        document.addEventListener('DOMContentLoaded', () => {
            const isAdmin = localStorage.getItem('cinerave_admin_mode');
            if (isAdmin === 'true') window.enableAdminMode();
            loadHomeContent();
            initSearchPage();
            setInterval(checkGlobalPremiumValidity, 30000);
        });

        function getBadgesHTML(item) {
            let html = '<div class="badge-container">';
            if (item.quality && item.quality.includes('4K')) html += '<span class="content-badge badge-4k">4K</span>';
            else if (item.quality && item.quality.includes('HDCAM')) html += '<span class="content-badge badge-soon">CAM</span>';
            const now = new Date();
            const created = new Date(item.createdAt);
            const diffDays = Math.ceil(Math.abs(now - created) / (1000 * 60 * 60 * 24));
            if (item.isComingSoon) { html += '<span class="content-badge badge-soon">EM BREVE</span>'; } 
            else if (diffDays <= 7) { html += '<span class="content-badge badge-new">NOVO</span>'; }
            if (item.audio && item.audio.includes('Legendado')) html += '<span class="content-badge badge-sub">LEG</span>';
            if (item.audio && item.audio.includes('Nacional')) html += '<span class="content-badge badge-drive">BR</span>';
            if (item.isDrive) html += '<span class="content-badge badge-drive"><i class="fa-brands fa-google-drive"></i></span>';
            if (item.isTelegram) html += '<span class="content-badge badge-telegram"><i class="fa-brands fa-telegram"></i></span>';
            html += '</div>';
            return html;
        }

        function checkSchedule(dateStr) {
            if (!dateStr) return false;
            const scheduleDate = new Date(dateStr);
            const now = new Date();
            return scheduleDate > now;
        }

        async function loadHomeContent() {
            try {
                const q = query(collection(db, "content"), where("status", "==", "published"));
                const snapshot = await getDocs(q);
                window.allHomeContent = [];
                snapshot.forEach(doc => { window.allHomeContent.push({ id: doc.id, ...doc.data() }); });
                window.allHomeContent.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                renderHero(window.allHomeContent.slice(0, 5)); 
                renderAllCarousels();
                filterSearch();
            } catch (err) { console.error("Erro feed:", err); }
        }

        function renderHero(items) {
            const slider = document.getElementById('hero-slider');
            slider.innerHTML = '';
            if (items.length === 0) return;
            items.forEach((item, index) => {
                const slide = document.createElement('div');
                slide.className = `hero-slide ${index === 0 ? 'active' : ''}`;
                slide.style.backgroundImage = `url('${item.poster}')`; 
                if (item.backdrop) slide.style.backgroundImage = `url('${item.backdrop}')`;
                const genres = item.genres ? item.genres.split(',').slice(0, 2).join(' • ') : 'Geral';
                slide.innerHTML = `<div class="hero-gradient"><h2 class="text-4xl font-black text-white mb-2 px-4 leading-none uppercase drop-shadow-xl tracking-tight text-center" style="text-shadow: 0 4px 10px rgba(0,0,0,0.8);">${item.title}</h2><div class="flex items-center gap-3 text-[11px] text-gray-300 mb-6 font-semibold tracking-wide"><span class="text-green-400">98% Relevante</span><span>${item.year}</span><span>${genres}</span></div><div class="flex gap-3"><button onclick="openDetails('${item.id}')" class="bg-white text-black font-bold px-8 py-2.5 rounded-md text-sm hover:bg-gray-200 transition flex items-center gap-2"><i class="fa-solid fa-play"></i> Assista Já</button><button onclick="toggleMyList('${item.id}')" class="bg-gray-600/60 text-white font-bold px-4 py-2.5 rounded-md text-sm hover:bg-gray-600/80 transition flex items-center gap-2 backdrop-blur-sm"><i class="fa-solid fa-plus"></i> Minha Lista</button></div></div>`;
                slider.appendChild(slide);
            });
            if (heroInterval) clearInterval(heroInterval);
            let currentSlide = 0;
            const slides = document.querySelectorAll('.hero-slide');
            if (slides.length > 1) {
                heroInterval = setInterval(() => {
                    slides[currentSlide].classList.remove('active');
                    currentSlide = (currentSlide + 1) % slides.length;
                    slides[currentSlide].classList.add('active');
                }, 6000);
            }
        }

        function renderAllCarousels() {
            const container = document.getElementById('carousels-area');
            container.innerHTML = '';
            const categories = [
                { id: 'recent', title: 'Lançamentos Recentes', filter: c => true },
                { id: 'updated', title: 'Novos Episódios', filter: c => c.type === 'tv' && c.updatedAt > c.createdAt, isEpisodes: true },
                { id: 'movies', title: 'Filmes', filter: c => c.type === 'movie' },
                { id: 'series', title: 'Séries', filter: c => c.type === 'tv' },
                { id: 'soon', title: 'Em Breve', filter: c => c.isComingSoon === true },
            ];
            categories.forEach(cat => {
                let items = window.allHomeContent.filter(cat.filter);
                if (items.length === 0) return;
                const section = document.createElement('div');
                let innerHTML = '';
                if (cat.isEpisodes) {
                     innerHTML = items.map(item => {
                        let lastEpLabel = '';
                        let lastSeason = item.seasons ? item.seasons[item.seasons.length - 1] : null;
                        let lastEp = lastSeason && lastSeason.episodes ? lastSeason.episodes[lastSeason.episodes.length -1] : null;
                        if(lastSeason && lastEp) lastEpLabel = `T${lastSeason.season}E${lastEp.ep}`;
                        const bgImg = item.backdrop || item.poster;
                        return `<div class="carousel-item wide-item" onclick="playLatestEpisode('${item.id}')"><div class="relative w-full h-full"><img src="${bgImg}" class="carousel-thumb shadow-lg"><span class="badge-episode">${lastEpLabel}</span>${getBadgesHTML(item)}</div></div>`;
                     }).join('');
                } else {
                    innerHTML = items.map(item => `<div class="carousel-item" onclick="openDetails('${item.id}')"><div class="relative"><img src="${item.poster}" class="carousel-poster shadow-lg">${getBadgesHTML(item)}</div></div>`).join('');
                }
                section.innerHTML = `<div class="flex items-center justify-between px-4 mb-3"><h3 class="text-sm font-bold text-white uppercase tracking-wide border-l-4 border-white pl-2">${cat.title}</h3><button onclick="openViewMore('${cat.id}', '${cat.title}')" class="text-[10px] text-gray-400 hover:text-white font-bold uppercase tracking-wider">Ver Mais <i class="fa-solid fa-chevron-right ml-1"></i></button></div><div class="carousel-container">${innerHTML}</div>`;
                container.appendChild(section);
            });
        }
        
        window.playLatestEpisode = (showId) => {
            const item = window.allHomeContent.find(i => i.id === showId);
            if (!item || !item.seasons || item.seasons.length === 0) return;
            const lastSeason = item.seasons[item.seasons.length - 1];
            if (!lastSeason.episodes || lastSeason.episodes.length === 0) return;
            const lastEp = lastSeason.episodes[lastSeason.episodes.length - 1];
            
            window.currentPlayingEpisode = { showId: item.id, seasonIndex: item.seasons.length - 1, episodeIndex: lastSeason.episodes.length - 1 };
            openServerModal(lastEp, `${item.title} - T${lastSeason.season}E${lastEp.ep}`, lastEp.schedule);
        };

        async function loadUserFavorites() {
            if (!window.currentUserUid) return;
            const q = collection(db, `users/${window.currentUserUid}/favorites`);
            onSnapshot(q, (snapshot) => {
                window.userFavorites = new Set();
                snapshot.forEach(doc => window.userFavorites.add(doc.id));
                renderMyList();
                updateDetailFavoriteIcon(); 
            });
        }

        function renderMyList() {
            const grid = document.getElementById('mylist-grid');
            const empty = document.getElementById('mylist-empty');
            grid.innerHTML = '';
            const favItems = window.allHomeContent.filter(item => window.userFavorites.has(item.id));
            if (favItems.length === 0) { empty.classList.remove('hidden'); empty.classList.add('flex'); } 
            else {
                empty.classList.add('hidden'); empty.classList.remove('flex');
                grid.innerHTML = favItems.map(item => `<div class="animate-fade-in flex flex-col gap-2 relative"><div class="relative" onclick="openDetails('${item.id}')"><img src="${item.poster}" class="grid-item-poster shadow-md">${getBadgesHTML(item)}</div><button onclick="toggleMyList('${item.id}')" class="w-full py-1.5 rounded-lg bg-red-600/20 border border-red-600/30 text-red-500 text-[10px] font-bold hover:bg-red-600 hover:text-white transition flex items-center justify-center gap-1"><i class="fa-solid fa-trash"></i> Remover</button></div>`).join('');
            }
        }

        window.toggleMyList = async (contentId) => {
            if (!window.currentUserUid) return window.openAuthModal();
            const id = contentId || window.currentDetailItem?.id;
            if (!id) return;
            const ref = doc(db, `users/${window.currentUserUid}/favorites/${id}`);
            if (window.userFavorites.has(id)) { await deleteDoc(ref); window.showToast("Removido da lista", "info"); } 
            else { await setDoc(ref, { addedAt: new Date().toISOString() }); window.showToast("Adicionado à lista!", "success"); }
        };

        function updateDetailFavoriteIcon() {
            if (!window.currentDetailItem) return;
            const id = window.currentDetailItem.id;
            const icon = document.getElementById('detail-mylist-icon');
            const text = document.getElementById('detail-mylist-text');
            if (window.userFavorites.has(id)) { icon.className = "fa-solid fa-check text-xl text-green-400"; text.textContent = "Salvo"; text.classList.add("text-green-400"); } 
            else { icon.className = "fa-solid fa-plus text-xl text-white"; text.textContent = "Minha Lista"; text.classList.remove("text-green-400"); }
        }

        window.openReportModal = () => { if (!window.currentUserUid) return window.openAuthModal(); document.getElementById('report-modal').classList.add('active'); };
        window.submitReport = async () => {
            if (!window.currentDetailItem) return;
            const reason = document.querySelector('input[name="report_reason"]:checked')?.value;
            const msg = document.getElementById('report-msg').value;
            if (!reason) return window.showToast("Selecione um motivo", "error");
            const btn = document.getElementById('btn-send-report'); btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Enviando...';
            try {
                await addDoc(collection(db, "reports"), { contentId: window.currentDetailItem.id, contentTitle: window.currentDetailItem.title, poster: window.currentDetailItem.poster, userId: window.currentUserUid, reason: reason, message: msg, createdAt: new Date().toISOString(), status: 'pending' });
                document.getElementById('report-modal').classList.remove('active');
                window.showToast("Relatório enviado!", "success");
                document.getElementById('report-msg').value = '';
            } catch(e) { window.showToast("Erro ao enviar", "error"); } finally { btn.innerHTML = "ENVIAR RELATÓRIO"; }
        };

        window.showReports = async () => {
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('reports-container').classList.remove('hidden');
            const grid = document.getElementById('reports-grid');
            grid.innerHTML = '<div class="text-center py-10"><i class="fa-solid fa-circle-notch fa-spin"></i></div>';
            const snap = await getDocs(query(collection(db, "reports"), orderBy("createdAt", "desc"), limit(20)));
            grid.innerHTML = '';
            if (snap.empty) { grid.innerHTML = '<p class="text-center text-gray-500">Sem relatórios.</p>'; return; }
            const reasonMap = { 'broken_link': 'Link Quebrado', 'buffering': 'Travando', 'wrong_content': 'Conteúdo Errado', 'other': 'Outro' };
            snap.forEach(doc => {
                const r = doc.data();
                const div = document.createElement('div');
                div.className = 'bg-dark-card border border-white/10 p-3 rounded-xl flex gap-3 relative';
                div.innerHTML = `<img src="${r.poster}" class="w-12 h-16 object-cover rounded bg-black"><div class="flex-1"><div class="flex justify-between items-start mb-1"><span class="text-xs font-bold text-red-400 uppercase">${reasonMap[r.reason] || r.reason}</span><span class="text-[9px] text-gray-500">${new Date(r.createdAt).toLocaleDateString()}</span></div><p class="text-sm font-bold text-white mb-1">${r.contentTitle}</p><p class="text-xs text-gray-400 italic mb-2">"${r.message || 'Sem detalhes'}"</p><button onclick="window.deleteReport('${doc.id}', this)" class="text-[10px] text-red-500 hover:text-white border border-red-500/30 px-2 py-1 rounded">Excluir</button></div>`;
                grid.appendChild(div);
            });
        };
        window.hideReports = () => { document.getElementById('reports-container').classList.add('hidden'); document.getElementById('admin-dashboard').classList.remove('hidden'); };
        
        window.deleteReport = async (id, btn) => {
            if(!confirm("Excluir relatório?")) return;
            try { await deleteDoc(doc(db, "reports", id)); const card = btn.closest('.bg-dark-card'); if(card) card.remove(); window.showToast("Relatório excluído.", "info"); } catch(e) { console.error(e); window.showToast("Erro ao excluir.", "error"); }
        };

        function initSearchPage() {
            const genres = ["Ação", "Aventura", "Comédia", "Drama", "Terror", "Ficção", "Romance", "Anime", "Novelas", "LGBT", "Documentário", "Infantil"];
            const genreContainer = document.getElementById('genre-container');
            genreContainer.innerHTML = genres.map(g => `<button onclick="toggleGenre('${g}')" class="filter-chip genre-chip" data-genre="${g}">${g}</button>`).join('');
            filterSearch();
        }
        window.setSearchType = (type) => { currentSearchType = type; document.querySelectorAll('.type-filter').forEach(btn => { if(btn.dataset.type === type) btn.classList.add('active'); else btn.classList.remove('active'); }); filterSearch(); }
        window.toggleGenre = (genre) => { if (currentGenreFilter === genre) currentGenreFilter = ''; else currentGenreFilter = genre; document.querySelectorAll('.genre-chip').forEach(btn => { if(btn.dataset.genre === currentGenreFilter) btn.classList.add('active'); else btn.classList.remove('active'); }); filterSearch(); }
        const normalizeStr = (str) => str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        window.filterSearch = async () => {
            const queryRaw = document.getElementById('main-search-input').value;
            const queryNorm = normalizeStr(queryRaw);
            const grid = document.getElementById('search-results-grid');
            const liveGrid = document.getElementById('live-channels-grid');
            const countLabel = document.getElementById('search-count');
            const emptyState = document.getElementById('search-empty');
            
            if (currentSearchType === 'live') {
                grid.style.display = 'none';
                liveGrid.style.display = 'grid';
                liveGrid.innerHTML = '<div class="col-span-4 text-center py-4"><i class="fa-solid fa-circle-notch fa-spin"></i></div>';
                
                try {
                    const q = query(collection(db, "channels"));
                    const snap = await getDocs(q);
                    liveGrid.innerHTML = '';
                    let count = 0;
                    snap.forEach(doc => {
                        const ch = doc.data();
                        if (queryNorm && !normalizeStr(ch.name).includes(queryNorm)) return;
                        count++;
                        const div = document.createElement('div');
                        div.className = 'animate-fade-in cursor-pointer relative';
                        div.onclick = () => openLiveServerModal(ch);
                        div.innerHTML = `<img src="${ch.image}" class="search-item-poster shadow-md object-contain bg-black p-2"><div class="absolute bottom-0 w-full bg-black/70 text-center text-xs text-white py-1">${ch.name}</div>`;
                        liveGrid.appendChild(div);
                    });
                    countLabel.textContent = `${count} CANAIS`;
                    if (count === 0) { emptyState.classList.remove('hidden'); emptyState.classList.add('flex'); } else { emptyState.classList.add('hidden'); emptyState.classList.remove('flex'); }
                } catch(e) { console.error(e); }
                return;
            }

            grid.style.display = 'grid';
            liveGrid.style.display = 'none';

            let results = window.allHomeContent.filter(item => {
                if (queryNorm && !normalizeStr(item.title).includes(queryNorm)) return false;
                if (currentSearchType !== 'all') { if (currentSearchType !== item.type) return false; }
                if (currentGenreFilter && !item.genres.includes(currentGenreFilter)) return false;
                return true;
            });
            countLabel.textContent = `${results.length} CONTEÚDOS`;
            if (results.length === 0) { grid.innerHTML = ''; emptyState.classList.remove('hidden'); emptyState.classList.add('flex'); } 
            else { emptyState.classList.add('hidden'); emptyState.classList.remove('flex'); grid.innerHTML = results.map(item => `<div class="animate-fade-in cursor-pointer relative" onclick="openDetails('${item.id}')"><img src="${item.poster}" class="search-item-poster shadow-md">${getBadgesHTML(item)}</div>`).join(''); }
        };

        window.openDetails = async (id) => {
            const item = window.allHomeContent.find(i => i.id === id);
            if (!item) return;
            window.currentDetailItem = item;
            updateDetailFavoriteIcon();

            // Real-time listener for likes/dislikes
            if(window.currentContentUnsub) window.currentContentUnsub();
            window.currentContentUnsub = onSnapshot(doc(db, "content", id), (docSnap) => {
                if(docSnap.exists()) {
                    const d = docSnap.data();
                    document.getElementById('count-like').textContent = d.likesCount || 0;
                    document.getElementById('count-dislike').textContent = d.dislikesCount || 0;
                }
            });

            document.getElementById('detail-backdrop').src = item.backdrop || item.poster;
            document.getElementById('detail-poster').src = item.poster;
            document.getElementById('detail-title').textContent = item.title;
            document.getElementById('detail-year').textContent = item.year;
            document.getElementById('detail-genre').textContent = item.genres;
            document.getElementById('detail-overview').textContent = item.overview || "Sinopse não disponível.";
            
            const synopsisEl = document.getElementById('detail-overview');
            const readMoreBtn = document.getElementById('detail-read-more');
            synopsisEl.classList.remove('expanded');
            if (item.overview && item.overview.length > 150) { readMoreBtn.classList.remove('hidden'); readMoreBtn.textContent = 'Ver mais'; } else { readMoreBtn.classList.add('hidden'); }

            const castContainer = document.getElementById('detail-cast');
            castContainer.innerHTML = '';
            if (item.actors) {
                const actors = item.actors.split(', ');
                const actorPromises = actors.map(async (actor) => {
                    let imgUrl = `https://ui-avatars.com/api/?name=${actor}&background=333&color=fff`;
                    try {
                        const searchRes = await fetch(`https://api.themoviedb.org/3/search/person?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(actor)}`);
                        const searchData = await searchRes.json();
                        if (searchData.results && searchData.results.length > 0 && searchData.results[0].profile_path) {
                            imgUrl = `https://image.tmdb.org/t/p/w185${searchData.results[0].profile_path}`;
                        }
                    } catch(e) {}
                    return { name: actor, img: imgUrl };
                });
                Promise.all(actorPromises).then(results => {
                    castContainer.innerHTML = results.map(a => `<div class="flex-shrink-0 flex flex-col items-center w-16"><div class="w-14 h-14 rounded-full bg-dark-card border border-white/10 overflow-hidden mb-1 shadow-md"><img src="${a.img}" class="w-full h-full object-cover"></div><span class="text-[9px] text-gray-400 text-center leading-tight line-clamp-2">${a.name}</span></div>`).join('');
                });
            }

            if (item.type === 'tv') {
                document.getElementById('btn-watch-movie').classList.add('hidden');
                document.getElementById('series-container').classList.remove('hidden');
                const seasonSelect = document.getElementById('season-selector');
                seasonSelect.innerHTML = '';
                if(item.seasons && item.seasons.length > 0) {
                    item.seasons.forEach(s => { const opt = document.createElement('option'); opt.value = s.season; opt.text = `Temporada ${s.season}`; opt.className = 'text-black'; seasonSelect.add(opt); });
                    renderSeriesEpisodes(item.tmdbId, item.seasons[0].season, item.seasons);
                } else { seasonSelect.innerHTML = '<option>Temporada 1</option>'; }
            } else {
                document.getElementById('btn-watch-movie').classList.remove('hidden');
                document.getElementById('series-container').classList.add('hidden');
            }

            if (item.tmdbId) {
                fetch(`https://api.themoviedb.org/3/${item.type}/${item.tmdbId}?api_key=${TMDB_API_KEY}&language=pt-BR&append_to_response=release_dates,content_ratings`)
                .then(r => r.json())
                .then(data => {
                    const durEl = document.getElementById('detail-duration');
                    if (data.runtime) { durEl.textContent = `${data.runtime} min`; durEl.classList.remove('hidden'); }
                    else if (data.episode_run_time && data.episode_run_time.length > 0) { durEl.textContent = `${data.episode_run_time[0]} min`; durEl.classList.remove('hidden'); }
                    
                    let rating = null;
                    if(item.type === 'movie' && data.release_dates) { const br = data.release_dates.results.find(r => r.iso_3166_1 === 'BR'); if(br) rating = br.release_dates[0].certification; }
                    else if (item.type === 'tv' && data.content_ratings) { const br = data.content_ratings.results.find(r => r.iso_3166_1 === 'BR'); if(br) rating = br.rating; }
                    
                    if(rating) { const ageEl = document.getElementById('detail-age'); ageEl.textContent = rating === 'L' ? 'L' : `${rating}`; ageEl.style.backgroundColor = rating === 'L' ? '#10b981' : rating >= 18 ? '#000' : '#ef4444'; ageEl.classList.remove('hidden'); }
                });
            }

            // Update Vote Colors on Load
            updateVoteUI(id);

            document.getElementById('details-page').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; 
        };

        window.renderSeriesEpisodes = async (tmdbId, seasonNum, firestoreSeasons) => {
            const list = document.getElementById('episodes-list');
            list.innerHTML = '<div class="text-center py-4"><i class="fa-solid fa-circle-notch fa-spin text-white"></i></div>';
            try {
                const res = await fetch(`https://api.themoviedb.org/3/tv/${tmdbId}/season/${seasonNum}?api_key=${TMDB_API_KEY}&language=pt-BR`);
                const tmdbData = await res.json();
                const fsSeason = firestoreSeasons.find(s => s.season == seasonNum);
                const fsEpisodes = fsSeason ? fsSeason.episodes : [];
                list.innerHTML = '';
                if (tmdbData.episodes) {
                    tmdbData.episodes.forEach((ep, idx) => {
                        const linkData = fsEpisodes.find(f => f.ep == ep.episode_number);
                        const hasLink = linkData && (linkData.link || linkData.rave || linkData.embed);
                        if (!hasLink) return;

                        const img = ep.still_path ? `https://image.tmdb.org/t/p/w300${ep.still_path}` : 'https://placehold.co/300x170/222/999?text=No+Img';
                        const runtime = ep.runtime ? `${ep.runtime}m` : '';
                        const div = document.createElement('div');
                        div.className = `episode-card group cursor-pointer hover:bg-white/5`;
                        
                        div.onclick = () => {
                            window.currentPlayingEpisode = { 
                                showId: window.currentDetailItem.id, 
                                seasonIndex: firestoreSeasons.findIndex(s => s.season == seasonNum), 
                                episodeIndex: fsEpisodes.findIndex(f => f.ep == ep.episode_number) 
                            };
                            openServerModal(linkData, `S${seasonNum}:E${ep.episode_number} - ${ep.name}`, linkData.schedule);
                        };
                        div.innerHTML = `<div class="relative episode-thumb"><img src="${img}" class="w-full h-full object-cover rounded"><div class="absolute inset-0 flex items-center justify-center bg-black/40 opacity-0 group-hover:opacity-100 transition"><i class="fa-solid fa-play text-white"></i></div></div><div class="flex-1 min-w-0"><h4 class="text-sm font-bold text-white truncate">${ep.episode_number}. ${ep.name}</h4><p class="text-[10px] text-gray-400 line-clamp-2">${ep.overview || ''}</p><span class="text-[10px] text-gray-500 font-mono mt-1 block">${runtime}</span></div>`;
                        list.appendChild(div);
                    });
                }
            } catch(e) { list.innerHTML = '<div class="text-center text-red-500 text-xs">Erro ao carregar episódios.</div>'; }
        };

        window.changeSeason = (val) => { if(window.currentDetailItem) renderSeriesEpisodes(window.currentDetailItem.tmdbId, val, window.currentDetailItem.seasons); };
        window.closeDetails = () => { 
            document.getElementById('details-page').classList.add('hidden'); 
            document.body.style.overflow = ''; 
            if(window.currentContentUnsub) { window.currentContentUnsub(); window.currentContentUnsub = null; }
        };
        window.toggleSynopsis = () => { const el = document.getElementById('detail-overview'); const btn = document.getElementById('detail-read-more'); el.classList.toggle('expanded'); btn.textContent = el.classList.contains('expanded') ? 'Ver menos' : 'Ver mais'; };
        
        window.shareContent = () => { 
            if(!window.currentDetailItem) return;
            const contentId = window.currentDetailItem.id;
            const baseUrl = window.location.origin + window.location.pathname;
            const fullUrl = `${baseUrl}?content=${contentId}`;
            const text = `Assista *${window.currentDetailItem.title}* no CineRave! 🍿\nAcesse agora: ${fullUrl}`;
            navigator.clipboard.writeText(text).then(() => window.showToast("Link copiado! Compartilhe.", "success"));
        };
        
        window.playContent = () => { if(window.currentDetailItem) openServerModal(window.currentDetailItem.links, window.currentDetailItem.title, window.currentDetailItem.scheduleGeneral); };
        window.openServerModalForMovie = () => {
            window.currentPlayingEpisode = null;
            openServerModal(window.currentDetailItem.links, window.currentDetailItem.title, window.currentDetailItem.scheduleGeneral);
        };

        window.openServerModal = (linksObj, titleContext, scheduleTime) => {
            const modal = document.getElementById('server-modal');
            const list = document.getElementById('server-list');
            const lockScreen = document.getElementById('lock-screen');
            const lockDate = document.getElementById('lock-date');
            const premiumHint = document.getElementById('lock-premium-hint');
            const isPremium = window.checkUserPremium();

            modal.classList.add('active');
            window.currentPlayTitle = titleContext || "Conteúdo"; 

            if (checkSchedule(scheduleTime)) {
                if (isPremium) {
                    lockScreen.classList.add('hidden');
                    list.classList.remove('opacity-10', 'pointer-events-none');
                } else {
                    lockScreen.classList.remove('hidden');
                    lockDate.textContent = new Date(scheduleTime).toLocaleString();
                    premiumHint.classList.remove('hidden');
                    list.classList.add('opacity-10', 'pointer-events-none');
                    return; 
                }
            } else {
                lockScreen.classList.add('hidden');
                premiumHint.classList.add('hidden');
                list.classList.remove('opacity-10', 'pointer-events-none');
            }

            if (!linksObj) return window.showToast("Nenhum link disponível.", "error");
            
            list.innerHTML = '';

            const getUrl = (type) => {
                if (type === 'principal') return linksObj.main || linksObj.link || (typeof linksObj === 'string' ? linksObj : null);
                if (type === 'rave') return linksObj.rave;
                if (type === 'drive') return linksObj.drive;
                if (type === 'telegram') return linksObj.telegram;
                if (linksObj.extras && Array.isArray(linksObj.extras)) {
                    const found = linksObj.extras.find(e => e.type === type);
                    if (found) return found.url;
                }
                return null;
            }

            const servers = [
                { id: 'principal', name: 'Principal', icon: '<i class="fa-solid fa-play text-white text-xl"></i>', url: getUrl('principal'), action: 'player', restricted: false },
                { id: 'rave', name: 'Rave', img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTTiX0As5qFGbYQh14TWxXZC16AQdNEnq29fnJnKUPALVC5HagwfSMwkQI&s=10', url: getUrl('rave'), action: 'link', restricted: false },
                { id: 'drive', name: 'Drive (Premium)', img: 'https://1000logos.net/wp-content/uploads/2021/04/Google-Drive-logo.png', url: getUrl('drive'), action: 'link', restricted: true },
                { id: 'telegram', name: 'Telegram (Premium)', icon: '<i class="fa-brands fa-telegram text-blue-400 text-xl"></i>', url: getUrl('telegram'), action: 'link', restricted: true },
                { id: 'watchparty', name: 'Watch Party', icon: '<i class="fa-solid fa-film text-yellow-500 text-xl"></i>', url: null, label: 'Em Breve', restricted: false }
            ];

            servers.forEach(s => {
                const urlExists = !!s.url;
                let disabledClass = '';
                let clickAction = '';
                let subtext = '';
                let subClass = '';

                if (s.restricted && !isPremium) {
                    disabledClass = 'disabled';
                    subtext = 'Exclusivo Premium';
                    subClass = 'text-brand-premium font-bold';
                    clickAction = `onclick="window.showToast('Recurso Exclusivo Premium!', 'error'); window.switchTab('premium'); document.getElementById('server-modal').classList.remove('active');"`;
                } else if (!urlExists) {
                    disabledClass = s.id === 'watchparty' ? '' : 'disabled';
                    subtext = s.id === 'watchparty' ? 'Em Breve' : 'Indisponível';
                    subClass = 'text-gray-500';
                    clickAction = '';
                } else {
                    subtext = 'Disponível';
                    subClass = 'text-green-400';
                    if (s.action === 'player') clickAction = `onclick="openPlayer('${s.url}')"`;
                    else clickAction = `onclick="window.open('${s.url}', '_blank')"`;
                }

                let visual = s.img ? `<img src="${s.img}" class="server-logo">` : s.icon;
                list.innerHTML += `<div class="server-option ${disabledClass}" ${clickAction}><div class="flex items-center gap-3"><div class="w-8 flex justify-center">${visual}</div><div><p class="text-sm font-bold text-white">${s.name}</p><p class="text-[10px] ${subClass}">${subtext}</p></div></div><i class="fa-solid fa-chevron-right text-gray-600 text-xs"></i></div>`;
            });
            
            if (window.currentDetailItem && window.currentDetailItem.quality && !isPremium) {
                const q = window.currentDetailItem.quality;
                if (q.includes('4K') || q.includes('HDCAM')) {
                   const warn = document.createElement('div');
                   warn.className = 'mt-4 p-2 bg-red-900/20 border border-red-900/50 rounded text-center';
                   warn.innerHTML = '<p class="text-[10px] text-red-400 font-bold uppercase"><i class="fa-solid fa-triangle-exclamation"></i> Conteúdo de Alta Qualidade (4K) pode ser restrito para usuários Free.</p>';
                   list.appendChild(warn);
                }
            }
        };

        window.openPlayer = (url) => {
            if(!url) return;
            const video = document.getElementById('main-video');
            video.src = url;
            document.getElementById('player-title').textContent = window.currentPlayTitle || "Reproduzindo";
            document.getElementById('player-page').classList.add('active');
            document.getElementById('server-modal').classList.remove('active');
            
            const nextBtn = document.getElementById('btn-next-ep');
            if (window.currentPlayingEpisode) {
                nextBtn.style.display = 'flex';
            } else {
                nextBtn.style.display = 'none';
            }

            // Also attach listener for player view
            if(window.currentDetailItem) {
                if(window.currentContentUnsub) window.currentContentUnsub();
                window.currentContentUnsub = onSnapshot(doc(db, "content", window.currentDetailItem.id), (docSnap) => {
                    if(docSnap.exists()) {
                        const d = docSnap.data();
                        document.getElementById('count-like').textContent = d.likesCount || 0;
                        document.getElementById('count-dislike').textContent = d.dislikesCount || 0;
                    }
                });
            }
            updateVoteUI();
            video.play();
        };

        window.playNextEpisode = () => {
            if (!window.currentPlayingEpisode || !window.currentDetailItem) return;
            const { seasonIndex, episodeIndex } = window.currentPlayingEpisode;
            const seasons = window.currentDetailItem.seasons;
            
            let nextEpIdx = episodeIndex + 1;
            let nextSeasonIdx = seasonIndex;

            if (nextEpIdx >= seasons[seasonIndex].episodes.length) {
                nextSeasonIdx++;
                nextEpIdx = 0;
            }

            if (nextSeasonIdx < seasons.length && nextEpIdx < seasons[nextSeasonIdx].episodes.length) {
                const nextSeason = seasons[nextSeasonIdx];
                const nextEp = nextSeason.episodes[nextEpIdx];
                window.currentPlayingEpisode = { showId: window.currentDetailItem.id, seasonIndex: nextSeasonIdx, episodeIndex: nextEpIdx };
                openServerModal(nextEp, `S${nextSeason.season}:E${nextEp.ep} - ${nextEp.name || ''}`, nextEp.schedule);
            } else {
                window.showToast("Não há mais episódios disponíveis.", "info");
            }
        };

        window.closePlayer = () => {
            const video = document.getElementById('main-video');
            video.pause();
            video.src = "";
            document.getElementById('player-page').classList.remove('active');
            if(window.currentContentUnsub) { window.currentContentUnsub(); window.currentContentUnsub = null; }
        };

        window.togglePlay = () => {
            const video = document.getElementById('main-video');
            const icon = document.getElementById('play-icon');
            if (video.paused) { video.play(); icon.className = "fa-solid fa-pause text-xl"; } 
            else { video.pause(); icon.className = "fa-solid fa-play text-xl"; }
        };

        window.seekVideo = () => {
            const video = document.getElementById('main-video');
            const slider = document.getElementById('video-progress');
            const time = (slider.value / 100) * video.duration;
            video.currentTime = time;
        };

        window.toggleFullscreen = () => {
            const elem = document.getElementById("player-page");
            if (!document.fullscreenElement) { elem.requestFullscreen().catch(err => {}); } 
            else { document.exitFullscreen(); }
        };

        document.getElementById('main-video').addEventListener('timeupdate', () => {
            const video = document.getElementById('main-video');
            const slider = document.getElementById('video-progress');
            const timeLabel = document.getElementById('video-time');
            const val = (video.currentTime / video.duration) * 100;
            slider.value = val || 0;
            const format = (s) => { const m = Math.floor(s / 60); const sec = Math.floor(s % 60); return `${m}:${sec < 10 ? '0'+sec : sec}`; };
            timeLabel.textContent = `${format(video.currentTime)} / ${format(video.duration || 0)}`;
        });

        window.submitVote = async (type) => {
            if (!window.currentUserUid) return window.openAuthModal();
            if (!window.currentDetailItem) return;
            const contentId = window.currentDetailItem.id;
            const contentRef = doc(db, "content", contentId);
            const userVoteRef = doc(db, `users/${window.currentUserUid}/votes/${contentId}`);
            try {
                const userVoteSnap = await getDoc(userVoteRef);
                const currentVote = userVoteSnap.exists() ? userVoteSnap.data().type : null;
                
                if (currentVote === type) {
                    await deleteDoc(userVoteRef);
                    await updateDoc(contentRef, { [`${type}sCount`]: increment(-1) });
                    window.showToast("Voto removido.", "info");
                } else {
                    if (currentVote) { 
                        // Removing old vote count
                        await updateDoc(contentRef, { [`${currentVote}sCount`]: increment(-1) }); 
                    }
                    await setDoc(userVoteRef, { type: type });
                    await updateDoc(contentRef, { [`${type}sCount`]: increment(1) });
                    window.showToast(type === 'like' ? "Gostei!" : "Não gostei.", "success");
                }
                // UI updates automatically via listener now
                updateVoteUI(contentId); 
            } catch(e) { console.error(e); }
        };

        async function updateVoteUI(contentId) {
            const id = contentId || window.currentDetailItem?.id;
            if(!id) return;
            
            // NOTE: Counts are now handled by listener in openDetails/openPlayer. 
            // This function only toggles button colors based on user vote.
            
            if (window.currentUserUid) {
                const userVoteSnap = await getDoc(doc(db, `users/${window.currentUserUid}/votes/${id}`));
                const btnLike = document.getElementById('btn-like');
                const btnDislike = document.getElementById('btn-dislike');
                btnLike.classList.remove('bg-green-600/20', 'border-green-500', 'text-green-500');
                btnDislike.classList.remove('bg-red-600/20', 'border-red-500', 'text-red-500');
                if (userVoteSnap.exists()) {
                    const type = userVoteSnap.data().type;
                    if (type === 'like') { btnLike.classList.add('bg-green-600/20', 'border-green-500', 'text-green-500'); } 
                    else { btnDislike.classList.add('bg-red-600/20', 'border-red-500', 'text-red-500'); }
                }
            }
        }

        window.openViewMore = (catId, title) => {
            const grid = document.getElementById('view-more-grid');
            const page = document.getElementById('view-more-page');
            const home = document.getElementById('home');
            const header = document.getElementById('main-header');
            let items = [];
            if(catId === 'recent') items = window.allHomeContent;
            else if(catId === 'movies') items = window.allHomeContent.filter(c => c.type === 'movie');
            else if(catId === 'series') items = window.allHomeContent.filter(c => c.type === 'tv');
            else if(catId === 'updated') items = window.allHomeContent.filter(c => c.type === 'tv' && c.updatedAt > c.createdAt);
            else if(catId === 'soon') items = window.allHomeContent.filter(c => c.isComingSoon === true);
            document.getElementById('view-more-title').textContent = title;
            grid.innerHTML = items.map(item => `<div class="animate-fade-in relative" onclick="openDetails('${item.id}')"><img src="${item.poster}" class="grid-item-poster shadow-md"><h4>${item.title}</h4>${getBadgesHTML(item)}</div>`).join('');
            home.classList.remove('active'); header.classList.add('hidden'); page.classList.remove('hidden'); window.scrollTo(0, 0);
        };
        window.closeViewMore = () => { document.getElementById('view-more-page').classList.add('hidden'); document.getElementById('main-header').classList.remove('hidden'); document.getElementById('home').classList.add('active'); };

        window.showToast = (msg, type = 'info') => { const container = document.getElementById('toast-container'); const el = document.createElement('div'); el.className = `toast ${type} animate-slide-in`; let icon = '<i class="fa-solid fa-circle-info text-blue-400"></i>'; if (type === 'success') icon = '<i class="fa-solid fa-circle-check text-green-400"></i>'; if (type === 'error') icon = '<i class="fa-solid fa-triangle-exclamation text-red-400"></i>'; el.innerHTML = `${icon}<span>${msg}</span>`; container.appendChild(el); setTimeout(() => { el.classList.replace('animate-slide-in', 'animate-fade-out'); setTimeout(() => el.remove(), 300); }, 3000); };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const unsubUser = onSnapshot(doc(db, "users", user.uid), (docSnap) => {
                    if (docSnap.exists()) {
                        const userData = docSnap.data();
                        updateUserProfileUI(user, userData);
                    }
                });
                
                const chatRef = doc(db, "support_tickets", user.uid);
                onSnapshot(chatRef, (chatSnap) => {
                    if (chatSnap.exists()) {
                        const chatData = chatSnap.data();
                        const btnText = document.getElementById('support-btn-text');
                        const btn = document.getElementById('btn-support-profile');
                        const notify = document.getElementById('support-notify');
                        
                        if (chatData.status === 'open') {
                            btnText.textContent = "Ver Chat";
                            if (chatData.unreadCountUser > 0) {
                                notify.textContent = chatData.unreadCountUser;
                                notify.classList.remove('hidden');
                            } else {
                                notify.classList.add('hidden');
                            }
                        } else {
                            btnText.textContent = "Suporte 24h";
                            notify.classList.add('hidden');
                        }
                    }
                });

                document.getElementById('profile-logged-out').classList.add('hidden'); document.getElementById('profile-logged-out').classList.remove('flex');
                document.getElementById('profile-logged-in').classList.remove('hidden'); document.getElementById('profile-logged-in').classList.add('flex');
                window.currentUserUid = user.uid;
                window.currentUserName = user.displayName;
                loadUserFavorites();
            } else {
                document.getElementById('profile-logged-in').classList.add('hidden'); document.getElementById('profile-logged-in').classList.remove('flex');
                document.getElementById('profile-logged-out').classList.remove('hidden'); document.getElementById('profile-logged-out').classList.add('flex');
                document.getElementById('header-mylist-btn').classList.add('hidden');
                window.currentUserUid = null;
                window.currentUserName = null;
                window.currentUserIsPremium = false;
            }
        });

        function updateUserProfileUI(userAuth, firestoreData) {
            let isPremium = false;
            let planName = "Usuário Grátis";
            let isVerified = firestoreData.isVerified || false;
            window.premiumExpireDate = null;

            if (firestoreData.premiumExpiresAt) {
                const expireDate = new Date(firestoreData.premiumExpiresAt);
                if (expireDate > new Date()) {
                    isPremium = true;
                    planName = firestoreData.planName || "Premium";
                    window.premiumExpireDate = expireDate;
                } else {
                    isPremium = false;
                }
            }

            window.currentUserIsPremium = isPremium;

            document.getElementById('user-name').textContent = firestoreData.username || userAuth.displayName || "CineRaver";
            document.getElementById('user-avatar').src = firestoreData.photoURL || userAuth.photoURL || "https://i.ibb.co/5k02X0f/user-placeholder.png";
            document.getElementById('user-uid').textContent = userAuth.uid;

            const badgeEl = document.getElementById('user-badge');
            const dashboard = document.getElementById('premium-dashboard');
            const freeDashboard = document.getElementById('free-dashboard');
            const verifiedIcon = document.getElementById('verified-badge');
            const avatarRing = document.getElementById('avatar-ring');
            const expireLabel = document.getElementById('premium-expire-label');

            if (premiumTimerInterval) clearInterval(premiumTimerInterval);

            if (isPremium) {
                badgeEl.textContent = planName.toUpperCase();
                badgeEl.className = "px-3 py-1 rounded-full bg-brand-premium/20 border border-brand-premium text-brand-premium mb-2 inline-block text-[9px] uppercase font-bold";
                document.getElementById('btn-upgrade-profile').classList.add('hidden');
                document.getElementById('btn-renew-profile').classList.remove('hidden');
                dashboard.classList.remove('hidden');
                dashboard.classList.add('grid');
                freeDashboard.classList.add('hidden');

                if (planName === "Vitalício") {
                     expireLabel.classList.add('hidden');
                     document.getElementById('btn-renew-profile').classList.add('hidden');
                     isVerified = true;
                } else {
                    expireLabel.classList.remove('hidden');
                    updatePremiumTimer();
                    premiumTimerInterval = setInterval(updatePremiumTimer, 1000);
                }
                
                avatarRing.classList.remove('from-gray-700', 'via-gray-400', 'to-gray-700');
                avatarRing.classList.add('from-yellow-600', 'via-yellow-300', 'to-yellow-600');

                const reqLabel = document.getElementById('request-quota-label');
                checkRequestQuota(true).then(res => {
                    reqLabel.textContent = `Pedidos: ${res.remaining}`;
                });

            } else {
                badgeEl.textContent = "USUÁRIO GRÁTIS";
                badgeEl.className = "px-3 py-1 rounded-full bg-white/5 border border-white/10 text-brand-silver mb-2 inline-block text-[9px] uppercase font-bold";
                document.getElementById('btn-upgrade-profile').classList.remove('hidden');
                document.getElementById('btn-renew-profile').classList.add('hidden');
                dashboard.classList.add('hidden');
                dashboard.classList.remove('grid');
                freeDashboard.classList.remove('hidden');
                expireLabel.classList.add('hidden');
                isVerified = false;
                avatarRing.classList.add('from-gray-700', 'via-gray-400', 'to-gray-700');
                avatarRing.classList.remove('from-yellow-600', 'via-yellow-300', 'to-yellow-600');
            }

            if (isVerified) verifiedIcon.classList.remove('hidden'); else verifiedIcon.classList.add('hidden');
        }

        function updatePremiumTimer() {
            if (!window.premiumExpireDate) return;
            const now = new Date();
            const diff = window.premiumExpireDate - now;
            if (diff <= 0) {
                document.getElementById('expire-timer').textContent = "EXPIRADO";
                clearInterval(premiumTimerInterval);
                forceDowngrade();
                return;
            }
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            let text = "";
            if(days > 0) text += `${days}d `;
            text += `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
            document.getElementById('expire-timer').textContent = text;
        }

        async function forceDowngrade() {
            window.currentUserIsPremium = false;
            window.showToast("Seu Premium expirou!", "error");
            // Force reset on DB to be clean if needed, although user write perms might be revoked.
            // UI Downgrade is critical here
            document.getElementById('premium-dashboard').classList.add('hidden');
            document.getElementById('premium-dashboard').classList.remove('grid');
            document.getElementById('free-dashboard').classList.remove('hidden');
            document.getElementById('btn-upgrade-profile').classList.remove('hidden');
            document.getElementById('btn-renew-profile').classList.add('hidden');
            document.getElementById('user-badge').textContent = "USUÁRIO GRÁTIS";
            // Hard Reload to enforce rules
            setTimeout(() => location.reload(), 2000);
        }

        function checkGlobalPremiumValidity() { if (!window.currentUserUid) return; }
        window.checkUserPremium = () => { return window.currentUserIsPremium; };

        window.openRequestSearch = async () => {
            if(!window.currentUserUid) return window.openAuthModal();
            const quotaCheck = await checkRequestQuota();
            if(!quotaCheck.canRequest) return window.showToast(`Limite atingido! Espere até ${quotaCheck.resetDate}`, "error");
            document.getElementById('request-search-modal').classList.add('active');
            document.getElementById('req-search-input').value = '';
            document.getElementById('req-results').innerHTML = '';
        };

        window.handleRequestSearch = async (val) => {
            const container = document.getElementById('req-results');
            if(val.length < 3) return;
            try {
                const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_API_KEY}&language=pt-BR&query=${encodeURIComponent(val)}`);
                const data = await res.json();
                container.innerHTML = data.results.filter(i => i.media_type === 'movie' || i.media_type === 'tv').map(item => {
                    const title = item.title || item.name;
                    const poster = item.poster_path ? `https://image.tmdb.org/t/p/w92${item.poster_path}` : 'https://placehold.co/92x138/000/FFF?text=No+Img';
                    return `<div onclick="selectRequestItem('${item.id}', '${item.media_type}')" class="flex gap-3 p-3 border border-white/5 rounded-xl bg-white/5 hover:bg-white/10 cursor-pointer transition items-center"><img src="${poster}" class="w-10 h-14 rounded object-cover"><div><h4 class="text-sm font-bold text-white">${title}</h4><span class="text-[10px] text-gray-400 uppercase">${item.media_type}</span></div></div>`;
                }).join('');
            } catch(e) { console.error(e); }
        };

        window.selectRequestItem = async (id, type) => {
            try {
                const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_API_KEY}&language=pt-BR`);
                const data = await res.json();
                window.tempRequestData = { tmdbId: id, title: data.title || data.name, poster: data.poster_path ? `https://image.tmdb.org/t/p/w300${data.poster_path}` : '', overview: data.overview, type: type };
                document.getElementById('request-search-modal').classList.remove('active');
                document.getElementById('request-preview-modal').classList.add('active');
                document.getElementById('req-prev-poster').src = window.tempRequestData.poster;
                document.getElementById('req-prev-title').textContent = window.tempRequestData.title;
                document.getElementById('req-prev-overview').textContent = window.tempRequestData.overview || "Sem sinopse.";
                document.getElementById('req-note').value = '';
            } catch(e) { window.showToast("Erro ao selecionar", "error"); }
        };

        window.submitRequest = async () => {
            const btn = document.getElementById('btn-submit-req');
            const note = document.getElementById('req-note').value;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> ENVIANDO...'; btn.classList.add('btn-loading');
            try {
                const quotaCheck = await checkRequestQuota();
                if(!quotaCheck.canRequest) throw new Error("Cota excedida");
                await addDoc(collection(db, "requests"), { ...window.tempRequestData, note: note, userId: window.currentUserUid, userName: document.getElementById('user-name').textContent, createdAt: new Date().toISOString(), status: 'pending' });
                await updateDoc(doc(db, "users", window.currentUserUid), { requestsCount: increment(1), lastRequestDate: new Date().toISOString() });
                window.showToast("Pedido enviado com sucesso!", "success");
                document.getElementById('request-preview-modal').classList.remove('active');
            } catch(e) { window.showToast(e.message, "error"); } finally { btn.innerHTML = 'ENVIAR PEDIDO'; btn.classList.remove('btn-loading'); }
        };

        async function checkRequestQuota(onlyCheck = false) {
            const userRef = doc(db, "users", window.currentUserUid);
            const userSnap = await getDoc(userRef);
            if(!userSnap.exists()) return { canRequest: false };
            const userData = userSnap.data();
            const now = new Date();
            let limitCount = 1; 
            let resetDate = null;
            let currentCount = userData.requestsCount || 0;
            let lastReset = userData.lastRequestReset ? new Date(userData.lastRequestReset) : new Date(0);

            if(window.currentUserIsPremium) {
                const plan = userData.planName;
                if(plan === "Vitalício") {
                    limitCount = 10;
                    resetDate = new Date(now.getFullYear(), now.getMonth(), 1);
                } else {
                    limitCount = 5;
                    const diffHours = Math.abs(now - lastReset) / 36e5;
                    if(diffHours >= 72) resetDate = now; else resetDate = lastReset;
                }
            } else {
                const day = now.getDay();
                const diff = now.getDate() - day + (day === 0 && now.getHours() < 5 ? -7 : 0);
                resetDate = new Date(now.setDate(diff));
                resetDate.setHours(5,0,0,0);
            }

            if(lastReset < resetDate) {
                if(!onlyCheck) { await updateDoc(userRef, { requestsCount: 0, lastRequestReset: resetDate.toISOString() }); currentCount = 0; } else { currentCount = 0; }
            }
            return { canRequest: currentCount < limitCount, remaining: limitCount - currentCount, resetDate: "próximo ciclo" };
        }

        window.handleSupportClick = async () => {
            if(!window.currentUserUid) return;
            const chatSnap = await getDoc(doc(db, "support_tickets", window.currentUserUid));
            if (chatSnap.exists() && chatSnap.data().status === 'open') {
                window.openChatModal(window.currentUserUid);
            } else {
                openSupport();
            }
        };

        window.openSupport = () => {
            if(!window.currentUserIsPremium) return window.showToast("Exclusivo Premium", "error");
            document.getElementById('support-intro-modal').classList.add('active');
        };

        window.startSupportChat = async () => {
            const msg = document.getElementById('support-intro-msg').value;
            if(!msg) return window.showToast("Descreva o problema", "error");
            const chatId = window.currentUserUid;
            await setDoc(doc(db, "support_tickets", chatId), { userId: window.currentUserUid, userName: document.getElementById('user-name').textContent, lastMessage: msg, lastMessageAt: new Date().toISOString(), unreadCountUser: 0, unreadCountAdmin: 1, status: 'open' }, { merge: true });
            await addDoc(collection(db, `support_tickets/${chatId}/messages`), { text: msg, sender: 'user', createdAt: new Date().toISOString() });
            document.getElementById('support-intro-modal').classList.remove('active');
            window.openChatModal(chatId);
        };

        window.openChatModal = (chatId) => {
            window.activeChatId = chatId;
            document.getElementById('chat-modal').classList.add('active');
            const container = document.getElementById('chat-messages');
            container.innerHTML = '<div class="text-center text-xs text-gray-500 mt-4">Carregando mensagens...</div>';
            if(window.chatUnsub) window.chatUnsub();
            
            const isAdminMode = localStorage.getItem('cinerave_admin_mode') === 'true';
            const fieldToReset = isAdminMode ? 'unreadCountAdmin' : 'unreadCountUser';
            updateDoc(doc(db, "support_tickets", chatId), { [fieldToReset]: 0 });

            const q = query(collection(db, `support_tickets/${chatId}/messages`), orderBy('createdAt', 'asc'));
            window.chatUnsub = onSnapshot(q, (snap) => {
                container.innerHTML = '';
                snap.forEach(doc => {
                    const msg = doc.data();
                    const div = document.createElement('div');
                    let cssClass = 'other';
                    if (isAdminMode) { if (msg.sender === 'admin') cssClass = 'mine'; } else { if (msg.sender === 'user') cssClass = 'mine'; }
                    div.className = `chat-msg ${cssClass}`;
                    div.textContent = msg.text;
                    container.appendChild(div);
                });
                container.scrollTop = container.scrollHeight;
            });
        };

        window.sendMessage = async () => {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if(!text || !window.activeChatId) return;
            const isAdminMode = localStorage.getItem('cinerave_admin_mode') === 'true';
            const sender = isAdminMode ? 'admin' : 'user';
            
            await addDoc(collection(db, `support_tickets/${window.activeChatId}/messages`), { text: text, sender: sender, createdAt: new Date().toISOString() });
            
            const updates = { lastMessage: text, lastMessageAt: new Date().toISOString() };
            if (sender === 'admin') updates.unreadCountUser = increment(1);
            else updates.unreadCountAdmin = increment(1);
            
            await updateDoc(doc(db, "support_tickets", window.activeChatId), updates);
            input.value = '';
        };

        window.closeChat = () => { document.getElementById('chat-modal').classList.remove('active'); if(window.chatUnsub) window.chatUnsub(); window.activeChatId = null; };

        // --- LIVE CHANNELS ---
        window.openChannelManager = () => { 
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-channels-container').classList.add('hidden'); 
            document.getElementById('channel-modal').classList.add('active'); 
            document.getElementById('channel-name').value = '';
            document.getElementById('channel-image').value = '';
            document.getElementById('channel-id').value = '';
            document.getElementById('channel-links-container').innerHTML = '';
            addChannelLinkBox(); // Add one empty box
        };
        window.closeChannelManager = () => { 
            document.getElementById('channel-modal').classList.remove('active'); 
            document.getElementById('admin-dashboard').classList.remove('hidden'); 
        };
        window.addChannelLinkBox = (name='', url='', isPrem=false) => {
            const container = document.getElementById('channel-links-container');
            const div = document.createElement('div');
            div.className = 'bg-white/5 p-2 rounded border border-white/10 flex flex-col gap-2 relative';
            div.innerHTML = `<button onclick="this.parentElement.remove()" class="absolute top-1 right-2 text-red-500 text-xs"><i class="fa-solid fa-xmark"></i></button><input type="text" class="link-name custom-input p-1 text-xs rounded" placeholder="Nome (Ex: Opção 1)" value="${name}"><input type="text" class="link-url custom-input p-1 text-xs rounded" placeholder="Link M3U8/MP4" value="${url}"><label class="flex items-center gap-2 text-xs text-gray-400"><input type="checkbox" class="link-prem accent-brand-premium" ${isPrem ? 'checked' : ''}> Apenas Premium</label>`;
            container.appendChild(div);
        };
        window.saveChannel = async () => {
            const id = document.getElementById('channel-id').value;
            const name = document.getElementById('channel-name').value;
            const img = document.getElementById('channel-image').value;
            const linkDivs = document.querySelectorAll('#channel-links-container > div');
            const links = [];
            linkDivs.forEach(d => {
                links.push({
                    name: d.querySelector('.link-name').value || 'Servidor',
                    url: d.querySelector('.link-url').value,
                    isPremium: d.querySelector('.link-prem').checked
                });
            });
            if (!name || !img || links.length === 0) return window.showToast("Preencha todos os campos", "error");
            
            const data = { name, image: img, links, updatedAt: new Date().toISOString() };
            try {
                if (id) await setDoc(doc(db, "channels", id), data, {merge:true});
                else await addDoc(collection(db, "channels"), data);
                window.showToast("Canal salvo!", "success");
                window.closeChannelManager();
                window.showAdminChannels();
            } catch(e) { window.showToast("Erro ao salvar", "error"); }
        };
        window.openLiveServerModal = (channel) => {
            const modal = document.getElementById('server-modal');
            const list = document.getElementById('server-list');
            modal.classList.add('active');
            list.innerHTML = '';
            document.getElementById('lock-screen').classList.add('hidden');
            const isPremium = window.checkUserPremium();
            
            channel.links.forEach(l => {
                let disabled = '';
                let click = `onclick="openPlayer('${l.url}')"`;
                let subtext = "Disponível";
                let subClass = "text-green-400";
                
                if (l.isPremium && !isPremium) {
                    disabled = 'disabled';
                    subtext = 'Exclusivo Premium';
                    subClass = 'text-brand-premium';
                    click = `onclick="window.showToast('Canal Premium!', 'error');"`;
                }
                list.innerHTML += `<div class="server-option ${disabled}" ${click}><div class="flex items-center gap-3"><div class="w-8 flex justify-center"><i class="fa-solid fa-tv text-white"></i></div><div><p class="text-sm font-bold text-white">${l.name}</p><p class="text-[10px] ${subClass}">${subtext}</p></div></div></div>`;
            });
        };

        window.showAdminChannels = async () => {
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-channels-container').classList.remove('hidden');
            const grid = document.getElementById('admin-channels-grid');
            grid.innerHTML = '<div class="text-center py-4"><i class="fa-solid fa-circle-notch fa-spin"></i></div>';
            
            const q = query(collection(db, "channels"));
            const snap = await getDocs(q);
            grid.innerHTML = '';
            
            if(snap.empty) return grid.innerHTML = '<p class="text-center text-gray-500 text-xs">Nenhum canal criado.</p>';
            
            snap.forEach(doc => {
                const ch = doc.data();
                const div = document.createElement('div');
                div.className = 'bg-dark-card border border-white/10 p-3 rounded-xl flex gap-3 relative items-center';
                div.innerHTML = `<img src="${ch.image}" class="w-12 h-12 object-cover rounded bg-black"><div class="flex-1"><h4 class="font-bold text-white text-sm">${ch.name}</h4><p class="text-[10px] text-gray-500">${ch.links.length} Servidores</p></div><button onclick="editChannel('${doc.id}')" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-gray-300 hover:text-white mr-2"><i class="fa-solid fa-pen text-xs"></i></button><button onclick="deleteChannel('${doc.id}')" class="w-8 h-8 rounded-full bg-red-900/20 flex items-center justify-center text-red-500 hover:text-white"><i class="fa-solid fa-trash text-xs"></i></button>`;
                grid.appendChild(div);
            });
        };
        
        window.hideAdminChannels = () => { document.getElementById('admin-channels-container').classList.add('hidden'); document.getElementById('admin-dashboard').classList.remove('hidden'); };
        
        window.deleteChannel = async (id) => {
            if(!confirm("Excluir canal?")) return;
            try { await deleteDoc(doc(db, "channels", id)); window.showAdminChannels(); window.showToast("Canal excluído.", "info"); } catch(e) { console.error(e); }
        };
        
        window.editChannel = async (id) => {
            const docRef = doc(db, "channels", id);
            const docSnap = await getDoc(docRef);
            if(docSnap.exists()){
                const ch = docSnap.data();
                document.getElementById('admin-channels-container').classList.add('hidden');
                document.getElementById('channel-modal').classList.add('active');
                document.getElementById('channel-id').value = id;
                document.getElementById('channel-name').value = ch.name;
                document.getElementById('channel-image').value = ch.image;
                document.getElementById('channel-links-container').innerHTML = '';
                ch.links.forEach(l => addChannelLinkBox(l.name, l.url, l.isPremium));
            }
        };

        window.showAdminRequests = async () => {
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-requests-container').classList.remove('hidden');
            const grid = document.getElementById('admin-requests-grid');
            grid.innerHTML = '<div class="text-center py-4"><i class="fa-solid fa-circle-notch fa-spin"></i></div>';
            const q = query(collection(db, "requests"), orderBy('createdAt', 'desc'), limit(50));
            const snap = await getDocs(q);
            grid.innerHTML = '';
            if(snap.empty) return grid.innerHTML = '<p class="text-center text-gray-500 text-xs">Sem pedidos.</p>';
            snap.forEach(doc => {
                const req = doc.data();
                const div = document.createElement('div');
                div.className = 'bg-dark-card border border-white/10 p-3 rounded-xl flex gap-3 relative';
                div.innerHTML = `<img src="${req.poster}" class="w-12 h-16 object-cover rounded bg-black"><div class="flex-1 overflow-hidden"><div class="flex justify-between items-start"><h4 class="font-bold text-white text-sm truncate pr-2">${req.title}</h4><span class="text-[9px] text-gray-500">${new Date(req.createdAt).toLocaleDateString()}</span></div><p class="text-[10px] text-brand-premium font-bold mb-1">${req.userName} <span class="text-gray-600 font-normal">(${req.userId})</span></p><p class="text-[10px] text-gray-400 italic truncate bg-white/5 p-1 rounded">"${req.note || 'Sem obs'}"</p></div><button onclick="window.deleteRequest('${doc.id}', this)" class="h-full px-2 text-red-500 hover:bg-red-900/20 rounded"><i class="fa-solid fa-trash"></i></button>`;
                grid.appendChild(div);
            });
        };

        window.deleteRequest = async (id, btn) => {
            if(!confirm("Excluir pedido?")) return;
            try { await deleteDoc(doc(db, "requests", id)); btn.parentElement.remove(); window.showToast("Pedido excluído.", "info"); } catch(e) { console.error(e); }
        };
        window.hideAdminRequests = () => { document.getElementById('admin-requests-container').classList.add('hidden'); document.getElementById('admin-dashboard').classList.remove('hidden'); };

        window.showAdminSupportList = async () => {
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-support-container').classList.remove('hidden');
            const grid = document.getElementById('admin-support-grid');
            grid.innerHTML = '<div class="text-center py-4"><i class="fa-solid fa-circle-notch fa-spin"></i></div>';
            const q = query(collection(db, "support_tickets"), orderBy('lastMessageAt', 'desc'));
            const snap = await getDocs(q);
            grid.innerHTML = '';
            if(snap.empty) return grid.innerHTML = '<p class="text-center text-gray-500 text-xs">Nenhum chamado aberto.</p>';
            snap.forEach(doc => {
                const ticket = doc.data();
                const div = document.createElement('div');
                div.className = 'bg-dark-card border border-white/10 p-4 rounded-xl flex justify-between items-center cursor-pointer hover:bg-white/5 relative';
                div.onclick = () => window.openChatModal(doc.id);
                const unreadBadge = ticket.unreadCountAdmin > 0 ? `<div class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>` : '';
                div.innerHTML = `${unreadBadge}<div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-pink-600/20 text-pink-500 flex items-center justify-center font-bold"><i class="fa-regular fa-user"></i></div><div><h4 class="font-bold text-white text-sm">Chat de ${ticket.userName}</h4><p class="text-[10px] text-gray-400 truncate max-w-[150px]">${ticket.lastMessage}</p></div></div><div class="text-right"><span class="text-[9px] text-gray-500 block">${new Date(ticket.lastMessageAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span><span class="text-[9px] bg-green-500/20 text-green-500 px-2 rounded">ABERTO</span></div>`;
                grid.appendChild(div);
            });
        };
        window.hideAdminSupportList = () => { document.getElementById('admin-support-container').classList.add('hidden'); document.getElementById('admin-dashboard').classList.remove('hidden'); };

        window.openEditProfile = () => { if (!window.currentUserIsPremium) return window.showToast("Recurso exclusivo Premium", "error"); document.getElementById('edit-profile-modal').classList.add('active'); document.getElementById('edit-name').value = document.getElementById('user-name').textContent; document.getElementById('edit-preview-img').src = document.getElementById('user-avatar').src; };
        window.closeEditProfile = () => { document.getElementById('edit-profile-modal').classList.remove('active'); window.editImageFile = null; };
        window.handleEditFileSelect = (e) => { const file = e.target.files[0]; if (file) { window.editImageFile = file; const reader = new FileReader(); reader.onload = (e) => { document.getElementById('edit-preview-img').src = e.target.result; }; reader.readAsDataURL(file); } };
        window.saveProfileChanges = async () => {
            const btn = document.getElementById('btn-save-profile'); const newName = document.getElementById('edit-name').value; const file = window.editImageFile;
            if (!newName) return window.showToast("Nome inválido", "error");
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> SALVANDO...';
            try {
                let photoURL = document.getElementById('user-avatar').src;
                if (file) { const formData = new FormData(); formData.append("image", file); const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData }); const data = await res.json(); if(data.success) { photoURL = data.data.url; } else { throw new Error("Erro no upload da imagem"); } }
                await updateDoc(doc(db, "users", window.currentUserUid), { username: newName, photoURL: photoURL });
                if (auth.currentUser) { await updateProfile(auth.currentUser, { displayName: newName, photoURL: photoURL }); }
                window.showToast("Perfil atualizado!", "success"); window.closeEditProfile();
            } catch(e) { console.error(e); window.showToast("Erro ao salvar: " + e.message, "error"); } finally { btn.innerHTML = 'SALVAR ALTERAÇÕES'; }
        };

        window.requestLogout = () => { document.getElementById('logout-confirm-modal').classList.add('active'); }
        window.confirmLogout = async () => {
            const btn = document.getElementById('btn-confirm-logout'); btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';
            try { await signOut(auth); document.getElementById('logout-confirm-modal').classList.remove('active'); window.showToast("Desconectado.", "info"); document.getElementById('profile-logged-in').classList.add('hidden'); document.getElementById('profile-logged-in').classList.remove('flex'); document.getElementById('profile-logged-out').classList.remove('hidden'); document.getElementById('profile-logged-out').classList.add('flex'); window.switchTab('profile'); } catch(e) { window.showToast(e.message, "error"); } finally { btn.innerHTML = 'Sair'; }
        }
        window.handleLogout = window.requestLogout;

        window.handleRegisterSubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('reg-email').value; const password = document.getElementById('reg-pass').value; const name = document.getElementById('reg-name').value; const file = window.selectedImageFile;
            if(!file) return window.showToast("Escolha uma foto de perfil", "error");
            const btn = document.getElementById('btn-register'); const oldText = btn.innerHTML; btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Criando...'; btn.classList.add('btn-loading');
            try {
                const formData = new FormData(); formData.append("image", file);
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData });
                const data = await res.json();
                if(!data.success) throw new Error("Erro upload imagem");
                const userCred = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(userCred.user, { displayName: name, photoURL: data.data.url });
                await setDoc(doc(db, "users", userCred.user.uid), { username: name, email: email, photoURL: data.data.url, uid: userCred.user.uid, plan: "free", createdAt: new Date().toISOString() });
                document.getElementById('user-name').textContent = name; document.getElementById('user-avatar').src = data.data.url; document.getElementById('user-uid').textContent = userCred.user.uid;
                window.resetAuthForms(); window.closeAuthModal(); window.switchTab('profile'); window.showToast("Conta criada!", "success");
            } catch(e) { window.showToast(e.message, "error"); } finally { btn.innerHTML = oldText; btn.classList.remove('btn-loading'); }
        };

        window.handleLoginSubmit = async (e) => { 
            e.preventDefault(); 
            const btn = document.getElementById('btn-login-submit'); const oldText = btn.innerHTML; btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>'; btn.classList.add('btn-loading');
            try { await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-pass').value); window.resetAuthForms(); window.closeAuthModal(); window.switchTab('profile'); window.showToast("Bem-vindo!", "success"); } 
            catch(e) { window.showToast(e.message, "error"); } finally { btn.innerHTML = oldText; btn.classList.remove('btn-loading'); }
        };
        window.resetAuthForms = () => { document.getElementById('login-form').reset(); document.getElementById('register-form').reset(); document.getElementById('preview-img').src = ""; document.getElementById('preview-img').classList.add('hidden'); window.selectedImageFile = null; };
        document.getElementById('register-form').addEventListener('submit', window.handleRegisterSubmit); document.getElementById('login-form').addEventListener('submit', window.handleLoginSubmit);

        window.handleFileSelect = (e) => { const file = e.target.files[0]; if(file){ window.selectedImageFile = file; const reader = new FileReader(); reader.onload = (e) => { document.getElementById('preview-img').src = e.target.result; document.getElementById('preview-img').classList.remove('hidden'); }; reader.readAsDataURL(file); } };
        window.switchTab = (tabId) => { window.closeAllOverlays(); document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active')); const target = document.getElementById(tabId); if(target) target.classList.add('active'); document.querySelectorAll('.nav-item').forEach(item => { item.classList.remove('active'); if (item.dataset.target === tabId) item.classList.add('active'); }); window.scrollTo(0,0); };
        window.closeAllOverlays = () => { window.closeDetails(); window.closePlayer(); window.closeAuthModal(); window.closeEditProfile(); window.closeViewMore(); window.closeChannelManager(); document.getElementById('admin-auth-modal').classList.remove('active'); document.getElementById('logout-confirm-modal').classList.remove('active'); document.getElementById('delete-modal').classList.remove('active'); document.getElementById('server-modal').classList.remove('active'); document.getElementById('request-search-modal').classList.remove('active'); document.getElementById('request-preview-modal').classList.remove('active'); document.getElementById('support-intro-modal').classList.remove('active'); document.getElementById('chat-modal').classList.remove('active'); };
        window.openAuthModal = () => document.getElementById('auth-modal').classList.add('active'); window.closeAuthModal = () => { document.getElementById('auth-modal').classList.remove('active'); window.resetAuthForms(); };
        window.toggleAuthMode = (mode) => { if(mode === 'login') { document.getElementById('login-form').classList.remove('hidden'); document.getElementById('register-form').classList.add('hidden'); document.getElementById('tab-login').classList.add('border-white', 'text-white'); document.getElementById('tab-register').classList.remove('border-white', 'text-white'); } else { document.getElementById('login-form').classList.add('hidden'); document.getElementById('register-form').classList.remove('hidden'); document.getElementById('tab-register').classList.add('border-white', 'text-white'); document.getElementById('tab-login').classList.remove('border-white', 'text-white'); } };
        window.copyUID = () => { if(window.currentUserUid) navigator.clipboard.writeText(window.currentUserUid).then(() => { const f = document.getElementById('copy-feedback'); f.classList.add('show'); setTimeout(() => f.classList.remove('show'), 2000); }); };

        window.handleTmdbSearch = async (e) => { const query = e.target.value; const resultsContainer = document.getElementById('tmdb-results'); const loader = document.getElementById('tmdb-loader'); if (query.length < 3) { resultsContainer.classList.add('hidden'); return; } loader.classList.remove('hidden'); try { const response = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${TMDB_API_KEY}&language=pt-BR&query=${encodeURIComponent(query)}&page=1&include_adult=false`); const data = await response.json(); resultsContainer.innerHTML = ''; const filtered = data.results.filter(item => item.media_type === 'movie' || item.media_type === 'tv'); if (filtered.length > 0) { filtered.forEach(item => { const title = item.title || item.name; const year = (item.release_date || item.first_air_date || '').split('-')[0]; const poster = item.poster_path ? `https://image.tmdb.org/t/p/w92${item.poster_path}` : 'https://placehold.co/92x138/000/FFF?text=No+Img'; const el = document.createElement('div'); el.className = 'flex items-center gap-3 p-3 border-b border-white/5 cursor-pointer tmdb-item transition'; el.innerHTML = `<img src="${poster}" class="w-10 h-14 object-cover rounded bg-dark-card"><div><h4 class="text-sm font-bold text-white leading-tight">${title}</h4><div class="flex items-center gap-2 mt-1"><span class="text-[10px] text-gray-400">${year}</span><span class="text-[9px] uppercase px-1.5 py-0.5 rounded bg-white/10 text-white">${item.media_type === 'movie' ? 'FILME' : 'SÉRIE'}</span></div></div>`; el.onclick = () => selectTmdbContent(item.id, item.media_type); resultsContainer.appendChild(el); }); resultsContainer.classList.remove('hidden'); } else { resultsContainer.classList.add('hidden'); } } catch (err) { console.error(err); } finally { loader.classList.add('hidden'); } };
        window.selectTmdbContent = async (id, type) => { 
            document.getElementById('tmdb-results').classList.add('hidden'); 
            document.getElementById('tmdb-search-input').value = ''; 
            try { 
                const response = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_API_KEY}&language=pt-BR&append_to_response=credits,videos`); 
                const data = await response.json(); 
                window.editingId = null; 
                document.getElementById('btn-publish-final').textContent = "PUBLICAR CONTEÚDO"; 
                populateFormFromData({ tmdbId: id, title: data.title || data.name, year: (data.release_date || data.first_air_date || '').split('-')[0], overview: data.overview, poster: data.poster_path ? `https://image.tmdb.org/t/p/w342${data.poster_path}` : 'https://placehold.co/300x450', backdrop: data.backdrop_path ? `https://image.tmdb.org/t/p/original${data.backdrop_path}` : '', genres: data.genres ? data.genres.map(g => g.name).join(', ') : '', actors: data.credits?.cast ? data.credits.cast.slice(0, 5).map(c => c.name).join(', ') : '', trailer: data.videos?.results.find(v => v.site === 'YouTube' && v.type === 'Trailer') ? `https://www.youtube.com/watch?v=${data.videos.results.find(v => v.site === 'YouTube' && v.type === 'Trailer').key}` : '', type: type, links: { main: '', extras: [] }, seasons: [] }); 
            } catch (err) { window.showToast("Erro ao carregar TMDB", "error"); console.log(err); } 
        };
        
        window.populateFormFromData = (data) => { document.getElementById('main-cms-form').classList.remove('hidden'); selectedContentType = data.type; document.getElementById('cms-tmdb-id').value = data.tmdbId; document.getElementById('cms-title').value = data.title; document.getElementById('cms-year').value = data.year; document.getElementById('cms-overview').value = data.overview; document.getElementById('cms-poster').src = data.poster; document.getElementById('cms-backdrop').value = data.backdrop; document.getElementById('cms-genres').value = data.genres; document.getElementById('cms-actors').value = data.actors; document.getElementById('cms-trailer').value = data.trailer; document.getElementById('check-coming-soon').checked = data.isComingSoon || false; document.getElementById('check-drive').checked = data.isDrive || false; document.getElementById('check-telegram').checked = data.isTelegram || false; document.getElementById('check-watch-party').checked = data.isWatchParty || false; document.getElementById('check-draft').checked = data.status === 'draft'; document.getElementById('schedule-general').value = data.scheduleGeneral || ''; document.getElementById('schedule-premium').value = data.schedulePremium || ''; document.querySelectorAll('.tag-select').forEach(el => { const type = el.dataset.type; const txt = el.innerText; if(data[type] && data[type].includes(txt)) el.classList.add('selected'); else el.classList.remove('selected'); }); const typeBadge = document.getElementById('cms-type-badge'); const movieLinks = document.getElementById('section-movie-links'); const seriesLinks = document.getElementById('section-series-links'); const watchPartyContainer = document.getElementById('container-watch-party'); if (data.type === 'movie') { typeBadge.textContent = 'FILME'; typeBadge.classList.replace('bg-blue-500/20', 'bg-white/10'); movieLinks.classList.remove('hidden'); seriesLinks.classList.add('hidden'); watchPartyContainer.classList.remove('hidden'); document.getElementById('movie-main-link').value = data.links?.main || ''; document.getElementById('movie-extra-links').innerHTML = ''; if(data.links?.extras) { data.links.extras.forEach(l => { addMovieLinkBox(l.type, l.url, l.embed); }); } } else { typeBadge.textContent = 'SÉRIE'; typeBadge.classList.add('bg-blue-500/20'); movieLinks.classList.add('hidden'); seriesLinks.classList.remove('hidden'); watchPartyContainer.classList.add('hidden'); document.getElementById('seasons-container').innerHTML = ''; if(data.seasons && data.seasons.length > 0) { data.seasons.forEach(s => { const seasonDiv = createSeasonDOM(s.season); document.getElementById('seasons-container').appendChild(seasonDiv); if(s.episodes) { const list = seasonDiv.querySelector('.episodes-list'); s.episodes.forEach(ep => { const epDiv = createEpisodeDOM(ep.ep, ep.link, ep.rave, ep.embed, ep.schedule); list.appendChild(epDiv); }); } }); } } };
        window.toggleTag = (el) => el.classList.toggle('selected');
        window.addMovieLinkBox = (type, val = '', embedVal = '') => { const container = document.getElementById('movie-extra-links'); const div = document.createElement('div'); div.className = 'relative bg-dark-card border border-white/5 p-3 rounded-lg mt-2'; let label = type.toUpperCase(); let colorClass = type === 'drive' ? 'text-yellow-500' : type === 'telegram' ? 'text-blue-500' : type === 'rave' ? 'text-red-500' : 'text-gray-400'; const commonHeader = `<div class="flex justify-between mb-1"><span class="text-[10px] font-bold ${colorClass}">${label}</span><button onclick="this.parentElement.parentElement.remove()" class="text-gray-600 hover:text-white"><i class="fa-solid fa-xmark"></i></button></div>`; const typeInput = `<input type="hidden" class="link-type" value="${type}">`; if (type === 'rave') { div.innerHTML = `${commonHeader}<input type="text" class="w-full custom-input p-2 rounded text-xs mb-2 rave-url" placeholder="Link MP4..." value="${val}"><input type="text" class="w-full custom-input p-2 rounded text-xs rave-embed" placeholder="Embed Code..." value="${embedVal}">${typeInput}`; } else { div.innerHTML = `${commonHeader}<input type="text" class="w-full custom-input p-2 rounded text-xs link-url" placeholder="URL..." value="${val}">${typeInput}`; } container.appendChild(div); };
        window.generateSeasons = () => { const count = parseInt(document.getElementById('input-season-count').value) || 1; const container = document.getElementById('seasons-container'); container.innerHTML = ''; for (let s = 1; s <= count; s++) { container.appendChild(createSeasonDOM(s)); } };
        window.addSeasonManual = () => { const container = document.getElementById('seasons-container'); const currentCount = container.children.length; container.appendChild(createSeasonDOM(currentCount + 1)); };
        window.addEpisodeManual = (btn, seasonNum) => { const list = btn.closest('.bg-dark-900').querySelector('.episodes-list'); const currentCount = list.children.length; list.appendChild(createEpisodeDOM(currentCount + 1)); };
        window.generateEpisodes = (btn, seasonNum) => { const count = parseInt(btn.previousElementSibling.value) || 1; const list = btn.closest('.bg-dark-900').querySelector('.episodes-list'); list.innerHTML = ''; for (let e = 1; e <= count; e++) { list.appendChild(createEpisodeDOM(e)); } };
        function createSeasonDOM(num) { const div = document.createElement('div'); div.className = 'bg-dark-900 border border-white/5 rounded-xl p-4 season-box'; div.dataset.season = num; div.innerHTML = `<div class="flex justify-between items-center mb-3"><h4 class="text-sm font-bold text-white">Temporada ${num}</h4><div class="flex gap-2 items-center"><button onclick="this.closest('.season-box').remove()" class="bg-red-900/30 text-red-500 px-2 py-1 rounded text-xs"><i class="fa-solid fa-trash"></i></button><button onclick="addEpisodeManual(this, ${num})" class="bg-white/5 hover:bg-white/10 text-white text-[10px] px-2 py-1 rounded font-bold mr-2">+ Ep</button><input type="number" class="ep-count-input w-12 bg-dark-card border border-white/10 rounded px-1 py-1 text-xs text-center" placeholder="Qtd"><button onclick="generateEpisodes(this, ${num})" class="bg-white/10 hover:bg-white/20 text-white text-[10px] px-2 py-1 rounded">Gerar</button></div></div><div class="episodes-list space-y-2"></div>`; return div; }
        function createEpisodeDOM(num, link='', rave='', embed='', sched='') { const div = document.createElement('div'); div.className = 'bg-dark-card p-3 rounded-lg border border-white/5 episode-box'; div.dataset.episode = num; div.innerHTML = `<div class="flex justify-between items-center mb-2"><span class="text-[10px] font-bold text-gray-400">EPISÓDIO ${num}</span><button onclick="this.parentElement.parentElement.remove()" class="text-gray-600 hover:text-red-500"><i class="fa-solid fa-xmark"></i></button></div><div class="grid grid-cols-1 gap-2"><input type="text" class="ep-link w-full custom-input p-2 rounded text-[10px]" placeholder="Link Principal" value="${link}"><div class="flex gap-2"><input type="text" class="ep-rave w-1/2 custom-input p-2 rounded text-[10px]" placeholder="Rave MP4" value="${rave}"><input type="text" class="ep-embed w-1/2 custom-input p-2 rounded text-[10px]" placeholder="Embed Code" value="${embed}"></div><div class="mt-1"><label class="text-[9px] text-gray-600 uppercase">Agendamento</label><input type="datetime-local" class="ep-schedule w-full bg-transparent border-b border-white/10 text-[10px] text-gray-400" value="${sched}"></div></div>`; return div; }

        window.showEditList = async () => { document.getElementById('admin-dashboard').classList.add('hidden'); document.getElementById('edit-list-container').classList.remove('hidden'); document.getElementById('edit-results-grid').innerHTML = '<div class="text-center text-gray-500 py-10"><i class="fa-solid fa-circle-notch fa-spin"></i></div>'; try { const querySnapshot = await getDocs(collection(db, "content")); window.contentListCache = []; querySnapshot.forEach((doc) => { window.contentListCache.push({ id: doc.id, ...doc.data() }); }); renderEditList(window.contentListCache); } catch (err) { document.getElementById('edit-results-grid').innerHTML = `<p class="text-red-500 text-center text-xs">Erro: ${err.message}</p>`; } };
        window.renderEditList = (list) => { const grid = document.getElementById('edit-results-grid'); grid.innerHTML = ''; if(list.length === 0) { grid.innerHTML = '<p class="text-center text-gray-500 text-xs">Nenhum conteúdo encontrado.</p>'; return; } list.forEach(item => { const statusClass = item.status === 'draft' ? 'status-draft' : 'status-published'; const statusText = item.status === 'draft' ? 'Rascunho' : 'Publicado'; const div = document.createElement('div'); div.className = 'edit-card bg-dark-card border border-white/5 rounded-xl p-3 flex gap-3 items-center relative'; div.innerHTML = `<img src="${item.poster}" class="w-12 h-16 object-cover rounded bg-black"><div class="flex-1"><h4 class="text-sm font-bold text-white leading-tight mb-1">${item.title}</h4><div class="flex gap-2 mb-2"><span class="${statusClass} status-badge">${statusText}</span><span class="text-[9px] text-gray-500 uppercase pt-0.5">${item.type}</span></div></div><div class="flex gap-2"><button onclick="editContent('${item.id}')" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-300"><i class="fa-solid fa-pen text-xs"></i></button><button onclick="confirmDelete('${item.id}')" class="w-8 h-8 rounded-full bg-white/5 hover:bg-red-900/20 flex items-center justify-center text-gray-300 hover:text-red-500"><i class="fa-solid fa-trash text-xs"></i></button><button onclick="deleteContentForce('${item.id}')" class="w-6 h-6 rounded-full bg-red-900/10 hover:bg-red-600 flex items-center justify-center text-red-500 hover:text-white" title="Forçar Exclusão"><i class="fa-solid fa-ban text-[10px]"></i></button></div>`; grid.appendChild(div); }); };
        window.filterEditList = (val) => { const filtered = window.contentListCache.filter(item => item.title.toLowerCase().includes(val.toLowerCase())); renderEditList(filtered); };
        window.editContent = (id) => { const item = window.contentListCache.find(c => c.id === id); if(item) { window.editingId = id; document.getElementById('edit-list-container').classList.add('hidden'); document.getElementById('publish-form-container').classList.remove('hidden'); document.getElementById('tmdb-search-block').classList.add('hidden'); document.getElementById('form-title').textContent = "EDITAR CONTEÚDO"; document.getElementById('btn-publish-final').textContent = "ATUALIZAR CONTEÚDO"; populateFormFromData(item); } };

        window.prePublishCheck = () => { const title = document.getElementById('cms-title').value; if(!title) return window.showToast("Título é obrigatório", "error"); const data = { tmdbId: document.getElementById('cms-tmdb-id').value, title: title, year: document.getElementById('cms-year').value, type: selectedContentType, overview: document.getElementById('cms-overview').value, poster: document.getElementById('cms-poster').src, backdrop: document.getElementById('cms-backdrop').value, genres: document.getElementById('cms-genres').value, trailer: document.getElementById('cms-trailer').value, actors: document.getElementById('cms-actors').value, updatedAt: new Date().toISOString(), quality: Array.from(document.querySelectorAll('.tag-select.selected[data-type="quality"]')).map(el => el.innerText), audio: Array.from(document.querySelectorAll('.tag-select.selected[data-type="audio"]')).map(el => el.innerText), isComingSoon: document.getElementById('check-coming-soon').checked, isDrive: document.getElementById('check-drive').checked, isTelegram: document.getElementById('check-telegram').checked, isWatchParty: selectedContentType === 'movie' ? document.getElementById('check-watch-party').checked : false, status: document.getElementById('check-draft').checked ? 'draft' : 'published', scheduleGeneral: document.getElementById('schedule-general').value || null, schedulePremium: document.getElementById('schedule-premium').value || null, }; if(!window.editingId) data.createdAt = new Date().toISOString(); if (selectedContentType === 'movie') { data.links = { main: document.getElementById('movie-main-link').value, extras: [] }; document.querySelectorAll('#movie-extra-links > div').forEach(div => { const type = div.querySelector('.link-type').value; if (type === 'rave') data.links.extras.push({ type: 'rave', url: div.querySelector('.rave-url').value, embed: div.querySelector('.rave-embed').value }); else data.links.extras.push({ type: type, url: div.querySelector('.link-url').value }); }); } else { data.seasons = []; document.querySelectorAll('#seasons-container > div').forEach(seasonDiv => { const seasonNum = seasonDiv.dataset.season; const episodes = []; seasonDiv.querySelectorAll('.episode-box').forEach(epDiv => { episodes.push({ ep: epDiv.dataset.episode, link: epDiv.querySelector('.ep-link').value, rave: epDiv.querySelector('.ep-rave').value, embed: epDiv.querySelector('.ep-embed').value, schedule: epDiv.querySelector('.ep-schedule').value || null }); }); data.seasons.push({ season: seasonNum, episodes: episodes }); }); } window.currentDataPayload = data; document.getElementById('preview-modal-img').src = data.poster; document.getElementById('preview-modal-title').textContent = data.title; document.getElementById('preview-modal-type').textContent = data.type === 'movie' ? 'FILME' : 'SÉRIE'; document.getElementById('preview-modal-status').textContent = data.status === 'draft' ? 'SALVAR COMO RASCUNHO' : 'PUBLICAR VISÍVEL'; document.getElementById('preview-modal-status').className = data.status === 'draft' ? 'text-[10px] mt-1 text-gray-400' : 'text-[10px] mt-1 text-green-400'; let countLinks = selectedContentType === 'movie' ? (data.links.extras.length + (data.links.main ? 1 : 0)) : 'N/A'; let countSeasons = selectedContentType === 'tv' ? data.seasons.length : 'N/A'; document.getElementById('preview-link-count').textContent = countLinks; document.getElementById('preview-season-count').textContent = countSeasons; document.getElementById('preview-schedule').textContent = data.scheduleGeneral ? new Date(data.scheduleGeneral).toLocaleString() : 'Imediato'; document.getElementById('preview-modal').classList.add('active'); };
        window.closePreview = () => document.getElementById('preview-modal').classList.remove('active');
        window.confirmPublish = async () => { 
            const btn = document.getElementById('btn-confirm-publish'); const oldText = btn.innerHTML; btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>'; btn.classList.add('btn-loading');
            try { 
                if(window.editingId) { await setDoc(doc(db, "content", window.editingId), window.currentDataPayload, { merge: true }); window.showToast("Conteúdo atualizado!", "success"); } 
                else { await addDoc(collection(db, "content"), window.currentDataPayload); window.showToast("Conteúdo publicado!", "success"); } 
                document.getElementById('preview-modal').classList.remove('active'); hidePublishForm(); loadHomeContent(); 
            } catch (err) { window.showToast("Erro: " + err.message, "error"); } finally { btn.innerHTML = oldText; btn.classList.remove('btn-loading'); }
        };
        window.confirmDelete = (id) => { window.pendingDeleteId = id; document.getElementById('delete-modal').classList.add('active'); };
        window.executeDelete = async () => { 
            const btn = document.getElementById('btn-confirm-delete'); const oldText = btn.innerHTML; btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';
            if(!window.pendingDeleteId) return; try { await deleteDoc(doc(db, "content", window.pendingDeleteId)); window.showToast("Excluído!", "info"); showEditList(); loadHomeContent(); } catch(e){ window.showToast(e.message, "error"); } finally { btn.innerHTML = oldText; document.getElementById('delete-modal').classList.remove('active'); }
        };
        window.deleteContentForce = async (id) => { 
            if(confirm("FORÇAR EXCLUSÃO IMEDIATA?")) { 
                try { await deleteDoc(doc(db, "content", id)); const grid = document.getElementById('edit-results-grid'); showEditList(); loadHomeContent(); window.showToast("Excluído forçadamente!", "info"); } catch(e){ console.error(e); window.showToast("Erro ao excluir: " + e.message, "error"); } 
            } 
        };
        
        window.showPremiumSender = () => {
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('premium-sender-container').classList.remove('hidden');
            document.getElementById('premium-uid-input').value = '';
            document.getElementById('premium-user-preview').classList.add('hidden');
            document.getElementById('premium-options-block').classList.add('hidden');
            window.premiumTargetUser = null;
        };

        window.hidePremiumSender = () => { document.getElementById('premium-sender-container').classList.add('hidden'); document.getElementById('admin-dashboard').classList.remove('hidden'); };

        window.verifyUserForPremium = async () => {
            const uid = document.getElementById('premium-uid-input').value.trim();
            if (!uid) return window.showToast("Digite o UID do usuário", "error");
            try {
                const userDoc = await getDoc(doc(db, "users", uid));
                if (userDoc.exists()) {
                    const data = userDoc.data();
                    window.premiumTargetUser = { uid: uid, ...data };
                    document.getElementById('premium-preview-img').src = data.photoURL || "https://i.ibb.co/5k02X0f/user-placeholder.png";
                    document.getElementById('premium-preview-name').textContent = data.username || "Sem Nome";
                    document.getElementById('premium-preview-email').textContent = data.email || "Sem Email";
                    const isPremium = data.premiumExpiresAt && new Date(data.premiumExpiresAt) > new Date();
                    const statusEl = document.getElementById('premium-preview-status');
                    statusEl.textContent = isPremium ? "PREMIUM ATIVO" : "GRÁTIS";
                    statusEl.className = isPremium ? "text-[9px] bg-green-500/20 text-green-500 px-2 rounded mt-1 inline-block" : "text-[9px] bg-white/10 px-2 rounded text-gray-300 mt-1 inline-block";
                    document.getElementById('premium-user-preview').classList.remove('hidden');
                    document.getElementById('premium-options-block').classList.remove('hidden');
                } else {
                    window.showToast("Usuário não encontrado.", "error");
                    document.getElementById('premium-user-preview').classList.add('hidden');
                    document.getElementById('premium-options-block').classList.add('hidden');
                }
            } catch (error) { console.error(error); window.showToast("Erro ao buscar usuário.", "error"); }
        };

        window.toggleCustomTime = (val) => { const block = document.getElementById('custom-time-inputs'); if (val === 'custom') block.classList.remove('hidden'); else block.classList.add('hidden'); };

        window.confirmSendPremium = async () => {
            if (!window.premiumTargetUser) return;
            const planType = document.getElementById('premium-plan-select').value;
            const btn = document.getElementById('btn-send-premium');
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> ENVIANDO...'; btn.classList.add('btn-loading');
            let expireDate = new Date(); let planName = ""; let isVerified = false;
            if (planType === 'vitalicio') { expireDate = new Date("2099-12-31T23:59:59"); planName = "Vitalício"; isVerified = true; } else if (planType === '30days') { expireDate.setDate(expireDate.getDate() + 30); planName = "Mensal"; } else if (planType === '5months') { expireDate.setDate(expireDate.getDate() + 150); planName = "5 Meses"; } else if (planType === '1year') { expireDate.setFullYear(expireDate.getFullYear() + 1); planName = "Anual"; } else if (planType === 'custom') { const d = parseInt(document.getElementById('custom-days').value) || 0; const h = parseInt(document.getElementById('custom-hours').value) || 0; const m = parseInt(document.getElementById('custom-minutes').value) || 0; if (d === 0 && h === 0 && m === 0) { btn.innerHTML = 'CONFIRMAR ENVIO'; btn.classList.remove('btn-loading'); return window.showToast("Defina um tempo válido.", "error"); } expireDate.setDate(expireDate.getDate() + d); expireDate.setHours(expireDate.getHours() + h); expireDate.setMinutes(expireDate.getMinutes() + m); planName = "Personalizado"; }
            try { await updateDoc(doc(db, "users", window.premiumTargetUser.uid), { premiumStatus: 'premium', premiumExpiresAt: expireDate.toISOString(), planName: planName, isVerified: isVerified, updatedAt: new Date().toISOString() }); window.showToast(`Premium enviado para ${window.premiumTargetUser.username}!`, "success"); window.hidePremiumSender(); } catch (error) { console.error(error); window.showToast("Erro ao enviar Premium.", "error"); } finally { btn.innerHTML = 'CONFIRMAR ENVIO'; btn.classList.remove('btn-loading'); }
        };

        window.startNewPublish = () => { window.editingId = null; document.getElementById('admin-dashboard').classList.add('hidden'); document.getElementById('publish-form-container').classList.remove('hidden'); document.getElementById('tmdb-search-block').classList.remove('hidden'); document.getElementById('main-cms-form').classList.add('hidden'); document.getElementById('form-title').textContent = "NOVA PUBLICAÇÃO"; document.getElementById('btn-publish-final').textContent = "PUBLICAR CONTEÚDO"; document.getElementById('cms-title').value = ''; document.getElementById('tmdb-search-input').value = ''; };
        window.hidePublishForm = () => { document.getElementById('publish-form-container').classList.add('hidden'); document.getElementById('admin-dashboard').classList.remove('hidden'); };
        window.hideEditList = () => { document.getElementById('edit-list-container').classList.add('hidden'); document.getElementById('admin-dashboard').classList.remove('hidden'); };
        window.handleLogoTap = () => { logoTapCount++; if (logoTapCount === 1) window.switchTab('home'); if (logoTapTimer) clearTimeout(logoTapTimer); logoTapTimer = setTimeout(() => { logoTapCount = 0; }, 800); if (logoTapCount >= 5) { document.getElementById('admin-auth-modal').classList.add('active'); document.getElementById('admin-pass-input').value = ''; document.getElementById('admin-pass-input').focus(); logoTapCount = 0; clearTimeout(logoTapTimer); } };
        window.checkAdminPass = (event) => { if (event.key === 'Enter') window.verifyAdmin(); };
        window.verifyAdmin = () => { if (document.getElementById('admin-pass-input').value === 'leoleo') { window.enableAdminMode(); document.getElementById('admin-auth-modal').classList.remove('active'); window.switchTab('admin'); window.showToast("Modo Admin Ativo", "success"); } else { const i = document.getElementById('admin-pass-input'); i.classList.add('border-red-500'); setTimeout(() => i.classList.remove('border-red-500'), 500); } };
        window.enableAdminMode = () => { localStorage.setItem('cinerave_admin_mode', 'true'); const adminBtn = document.getElementById('nav-admin-btn'); adminBtn.classList.remove('hidden'); adminBtn.classList.add('flex'); };
    </script>
</body>
</html>
