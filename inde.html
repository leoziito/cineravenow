<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cinerave - Premium Experience</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Syncopate:wght@700&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* --- CORE COLORS --- */
        :root {
            --bg-body: #050505;
            --bg-card: #0f0f0f;
            --accent: #ffffff;
            --nav-height: 80px; /* Altura aproximada da navbar */
        }

        body {
            background-color: var(--bg-body);
            color: #e5e5e5;
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow: hidden; /* O scroll é gerenciado internamente */
            height: 100vh;
        }

        /* --- METALLIC ANIMATION --- */
        .text-metallic-live {
            background: linear-gradient(
                110deg, 
                #8c8c8c 10%,   
                #ffffff 25%,   
                #a1a1aa 40%,   
                #ffffff 55%,   
                #71717a 70%,   
                #8c8c8c 90%    
            );
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: shine-flow 4s linear infinite;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
            cursor: pointer;
            user-select: none;
        }

        @keyframes shine-flow {
            to { background-position: 200% center; }
        }

        /* --- IMMERSIVE NAV --- */
        .nav-immersive {
            background: linear-gradient(to top, rgba(0,0,0,1) 20%, rgba(0,0,0,0.9) 60%, rgba(0,0,0,0) 100%);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding-bottom: env(safe-area-inset-bottom); /* Suporte iPhone X+ */
        }

        /* --- UTILS --- */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scale-in { animation: scaleIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .nav-btn.active svg { stroke: #ffffff; filter: drop-shadow(0 0 8px rgba(255,255,255,0.6)); }
        .nav-btn.active span { color: white; font-weight: 600; }
        .nav-btn svg { transition: all 0.3s ease; }

        .nav-btn.admin-active svg { stroke: #ef4444; filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.6)); }
        .nav-btn.admin-active span { color: #ef4444; font-weight: 600; }

        /* --- FORM ELEMENTS --- */
        .glass-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }
        .glass-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.08);
        }

        /* --- MODAL --- */
        .glass-modal {
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* --- TOAST NOTIFICATION --- */
        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            pointer-events: none;
            width: 90%;
            max-width: 400px;
        }
        .toast {
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        .toast.show { opacity: 1; transform: translateY(0); }

        /* Loader Spinner */
        .loader {
            border: 2px solid rgba(255,255,255,0.1);
            border-left-color: #ffffff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- CINEMA STYLES --- */
        .cinema-screen {
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.8);
            background: black;
            overflow: hidden;
            position: relative;
        }
        
        .chat-bubble {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(4px);
            border-radius: 12px;
            padding: 8px 12px;
            max-width: 85%;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .chat-input-area {
            background: rgba(5, 5, 5, 0.85);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px; /* Espaço extra para não colar no menu */
        }
    </style>
</head>
<body class="flex flex-col h-screen relative selection:bg-white selection:text-black">

    <!-- TOAST CONTAINER -->
    <div id="toast-container"></div>

    <!-- INFO MOVIE MODAL -->
    <div id="movie-info-modal" class="hidden fixed inset-0 z-[70] flex items-center justify-center bg-black/90 backdrop-blur-md p-6 fade-in" onclick="closeMovieInfo()">
        <div class="glass-modal w-full max-w-sm rounded-2xl p-0 overflow-hidden" onclick="event.stopPropagation()">
            <div class="relative h-64">
                <img id="modal-movie-poster" src="" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent"></div>
                <button onclick="closeMovieInfo()" class="absolute top-4 right-4 bg-black/50 p-2 rounded-full text-white hover:bg-white/20 transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6 relative -top-6">
                <h3 id="modal-movie-title" class="text-2xl font-['Syncopate'] font-bold text-white mb-2 leading-tight">Título do Filme</h3>
                <p id="modal-movie-overview" class="text-sm text-zinc-400 leading-relaxed max-h-40 overflow-y-auto pr-2 no-scrollbar">Sinopse do filme...</p>
            </div>
        </div>
    </div>

    <!-- ADMIN MODAL (Login) -->
    <div id="admin-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-6 fade-in">
        <div class="glass-modal w-full max-w-sm rounded-2xl p-6 text-center">
            <div class="mb-4">
                <i data-lucide="shield-alert" class="w-12 h-12 text-zinc-500 mx-auto mb-2"></i>
                <h3 class="text-lg font-light text-white tracking-widest uppercase">Acesso Restrito</h3>
            </div>
            <input type="password" id="admin-password" placeholder="Senha de Admin" class="glass-input w-full p-3 rounded-lg text-center text-lg mb-4 tracking-widest">
            <div class="flex gap-2">
                <button onclick="closeAdminModal()" class="flex-1 py-3 rounded-lg text-sm text-zinc-500 hover:text-white transition-colors">Cancelar</button>
                <button onclick="checkAdminAccess()" class="flex-1 bg-white text-black font-bold py-3 rounded-lg hover:bg-gray-200 transition-colors">Acessar</button>
            </div>
        </div>
    </div>

    <!-- HEADER (Fixo no topo) -->
    <header class="fixed top-0 left-0 w-full z-40 flex items-center justify-center pt-8 pb-4 bg-gradient-to-b from-black via-black/80 to-transparent pointer-events-none">
        <h1 id="app-logo" onclick="handleLogoClick()" class="font-['Syncopate'] text-3xl font-bold text-metallic-live pointer-events-auto select-none active:scale-95 transition-transform">
            CINERAVE
        </h1>
    </header>

    <!-- MAIN CONTENT (Estrutura ajustada para layout Flex do Cinema) -->
    <main class="flex-1 w-full max-w-md mx-auto h-full overflow-hidden relative z-10 flex flex-col">
        
        <!-- SECTION: INÍCIO (Scroll Normal) -->
        <section id="tab-inicio" class="tab-content fade-in block h-full overflow-y-auto no-scrollbar pt-24 pb-32 px-6">
            <div class="flex flex-col items-center justify-center h-[60vh] text-center space-y-4 opacity-50">
                <i data-lucide="clapperboard" class="w-16 h-16 text-zinc-800"></i>
                <h2 class="text-xl text-zinc-600 font-light tracking-widest uppercase">Início</h2>
                <p class="text-xs text-zinc-700">Bem-vindo ao Cinerave.</p>
            </div>
        </section>

        <!-- SECTION: BUSCA (Scroll Normal) -->
        <section id="tab-busca" class="tab-content hidden h-full overflow-y-auto no-scrollbar pt-24 pb-32 px-6">
            <div class="w-full h-12 bg-zinc-900/80 rounded-full border border-zinc-800 flex items-center px-4 mb-8">
                <i data-lucide="search" class="w-4 h-4 text-zinc-500 mr-3"></i>
                <input type="text" placeholder="Buscar filmes, séries..." class="bg-transparent w-full text-sm text-zinc-300 placeholder-zinc-600 focus:outline-none">
            </div>
            <div class="flex flex-col items-center justify-center h-[40vh] text-center space-y-4 opacity-50">
                <i data-lucide="search" class="w-16 h-16 text-zinc-800"></i>
                <p class="text-xs text-zinc-700">Em implementação.</p>
            </div>
        </section>

        <!-- SECTION: CINEMA (LAYOUT FIXO APRIMORADO) -->
        <section id="tab-cinema" class="tab-content hidden flex flex-col w-full h-full pt-[80px]"> <!-- pt-20 para compensar o header -->
            
            <!-- PLAYER (Area Superior Fixa) -->
            <div class="w-full bg-black shrink-0 relative z-20">
                <!-- Info Header -->
                <div onclick="openMovieInfo()" class="py-2 text-center cursor-pointer hover:bg-white/5 transition-colors">
                    <h2 id="now-playing-title" class="text-sm font-['Syncopate'] font-bold text-white tracking-widest truncate px-4">Aguardando Sessão...</h2>
                    <p class="text-[9px] text-zinc-500 uppercase tracking-widest flex items-center justify-center gap-1 mt-0.5">
                        <span class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"></span> Ao Vivo
                    </p>
                </div>

                <!-- Video Aspect Ratio Wrapper -->
                <div class="relative w-full aspect-video bg-zinc-900 cinema-screen group border-y border-zinc-900">
                    <video id="cinema-player" class="w-full h-full object-contain pointer-events-none" playsinline></video>
                    
                    <!-- Overlay Default -->
                    <div id="cinema-poster-overlay" class="absolute inset-0 bg-zinc-900 flex flex-col items-center justify-center z-10">
                        <img id="cinema-poster-img" src="" class="absolute inset-0 w-full h-full object-cover opacity-30 hidden">
                        <div class="relative z-20 flex flex-col items-center">
                            <i data-lucide="film" class="w-10 h-10 text-zinc-600 mb-2"></i>
                            <span class="text-[10px] text-zinc-500 uppercase tracking-widest">Nenhuma sessão ativa</span>
                        </div>
                    </div>

                    <!-- Mute Toggle -->
                    <div id="sound-overlay" onclick="toggleMute()" class="absolute inset-0 flex items-center justify-center bg-black/60 z-30 cursor-pointer hidden backdrop-blur-sm">
                        <div class="flex flex-col items-center animate-pulse">
                            <div class="bg-white/10 p-3 rounded-full border border-white/20 mb-2">
                                <i data-lucide="volume-x" class="w-6 h-6 text-white"></i>
                            </div>
                            <p class="text-[10px] text-white/80 font-medium uppercase tracking-wide">Toque para ativar som</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CHAT AREA (Flex Grow - Ocupa o espaço restante) -->
            <div class="flex-1 flex flex-col relative overflow-hidden bg-gradient-to-b from-zinc-950 to-black">
                
                <!-- Lista de Mensagens (Scrollável) -->
                <div id="chat-messages" class="flex-1 overflow-y-auto px-4 pt-4 pb-4 space-y-3 scroll-smooth no-scrollbar">
                    <!-- Mensagem Inicial do Sistema -->
                    <div class="flex justify-center mb-4">
                        <span class="text-[9px] text-zinc-500 bg-zinc-900/80 px-3 py-1.5 rounded-full border border-zinc-800 shadow-sm">
                            Chat ao vivo • Histórico de 24h
                        </span>
                    </div>
                    <!-- Mensagens entram aqui -->
                </div>

                <!-- INPUT AREA (Fixa na base desta section) -->
                <div class="w-full chat-input-area px-4 py-3 shrink-0 z-30 mb-[80px]"> <!-- mb-80px para não ficar atrás do menu nav -->
                    <div class="flex items-center gap-2 bg-zinc-900/80 border border-zinc-700/50 rounded-full p-1 pl-4 shadow-lg">
                        <input type="text" id="chat-input" class="flex-1 bg-transparent text-sm text-white focus:outline-none placeholder-zinc-500 h-10" placeholder="Digite sua mensagem...">
                        
                        <button onclick="sendMessage()" class="w-10 h-10 bg-white text-black rounded-full flex items-center justify-center hover:bg-gray-200 active:scale-95 transition-all shadow-md" id="btn-send-chat">
                            <i data-lucide="send" class="w-4 h-4 ml-0.5"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: PERFIL (Scroll Normal) -->
        <section id="tab-perfil" class="tab-content hidden h-full overflow-y-auto no-scrollbar pt-24 pb-32 px-6">
            <div id="auth-loading" class="flex flex-col items-center justify-center h-[50vh]">
                <div class="loader w-8 h-8 border-4"></div>
            </div>

            <div id="auth-forms" class="hidden flex-col gap-6">
                <!-- Login -->
                <div id="form-login" class="fade-in">
                    <h2 class="text-2xl font-light text-white mb-6 text-center tracking-wide">Bem-vindo de volta</h2>
                    <div class="space-y-4">
                        <input type="email" id="login-email" class="glass-input w-full p-4 rounded-xl text-sm" placeholder="Email">
                        <div class="relative">
                            <input type="password" id="login-password" class="glass-input w-full p-4 rounded-xl text-sm pr-12" placeholder="Senha">
                            <button onclick="togglePassword('login-password')" class="absolute right-4 top-4 text-zinc-500 hover:text-white"><i data-lucide="eye" class="w-4 h-4"></i></button>
                        </div>
                        <button id="btn-login" class="w-full bg-white text-black font-semibold p-4 rounded-xl hover:bg-gray-200 transition-colors mt-4">Entrar</button>
                    </div>
                    <div class="mt-6 text-center text-xs text-zinc-500">
                        Não tem conta? <button onclick="toggleAuthMode('register')" class="text-white underline ml-1">Criar agora</button>
                    </div>
                </div>

                <!-- Cadastro -->
                <div id="form-register" class="hidden fade-in">
                    <h2 class="text-2xl font-light text-white mb-6 text-center tracking-wide">Criar Conta</h2>
                    <div class="flex flex-col items-center mb-6">
                        <div class="relative group cursor-pointer" onclick="document.getElementById('reg-avatar').click()">
                            <div class="w-24 h-24 rounded-full bg-zinc-900 border border-zinc-700 flex items-center justify-center overflow-hidden">
                                <img id="avatar-preview" src="" class="w-full h-full object-cover hidden">
                                <i id="avatar-icon" data-lucide="camera" class="w-8 h-8 text-zinc-600"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 bg-white rounded-full p-1.5"><i data-lucide="plus" class="w-3 h-3 text-black"></i></div>
                        </div>
                        <input type="file" id="reg-avatar" accept="image/*" class="hidden" onchange="previewAvatar(event)">
                    </div>
                    <div class="space-y-4">
                        <input type="text" id="reg-name" class="glass-input w-full p-4 rounded-xl text-sm" placeholder="Nome">
                        <input type="email" id="reg-email" class="glass-input w-full p-4 rounded-xl text-sm" placeholder="Email">
                        <input type="password" id="reg-password" class="glass-input w-full p-4 rounded-xl text-sm" placeholder="Senha">
                        <button id="btn-register" class="w-full bg-white text-black font-semibold p-4 rounded-xl hover:bg-gray-200 transition-colors mt-4">Criar Conta</button>
                    </div>
                    <div class="mt-6 text-center text-xs text-zinc-500">
                        Já tem conta? <button onclick="toggleAuthMode('login')" class="text-white underline ml-1">Entrar</button>
                    </div>
                </div>
            </div>

            <!-- Logado -->
            <div id="user-profile" class="hidden flex-col items-center fade-in pt-8">
                <div class="relative mb-6">
                    <div class="w-32 h-32 rounded-full border-2 border-zinc-800 p-1">
                        <img id="profile-img" src="" class="w-full h-full rounded-full object-cover bg-zinc-900" alt="Profile">
                    </div>
                    <div class="absolute -bottom-3 left-1/2 transform -translate-x-1/2 bg-zinc-800 px-3 py-1 rounded-full shadow-lg flex items-center gap-1">
                        <i data-lucide="star" class="w-3 h-3 text-yellow-400 fill-yellow-400"></i>
                        <span class="text-[10px] font-bold text-white uppercase">Grátis</span>
                    </div>
                </div>
                <h2 id="profile-name" class="text-2xl font-medium text-white text-center mb-8">Usuário</h2>
                <div class="w-full bg-zinc-900/50 rounded-xl p-4 border border-zinc-800 mb-8 cursor-pointer" onclick="copyUid()">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs text-zinc-500 uppercase tracking-widest">User ID</span>
                        <i data-lucide="copy" class="w-3 h-3 text-zinc-500"></i>
                    </div>
                    <code id="profile-uid" class="text-xs text-zinc-400 font-mono break-all block">...</code>
                </div>
                <button id="btn-logout" class="w-full bg-red-500/10 text-red-500 p-4 rounded-xl border border-red-500/20 hover:bg-red-500/20 flex items-center justify-center gap-2 mt-8">
                    <i data-lucide="log-out" class="w-4 h-4"></i> Sair da conta
                </button>
            </div>
        </section>

        <!-- SECTION: ADMIN PANEL (Scroll Normal) -->
        <section id="tab-adm" class="tab-content hidden h-full overflow-y-auto no-scrollbar pt-24 pb-32 px-6">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-xl text-white font-['Syncopate'] uppercase tracking-widest">Painel Admin</h2>
                <span class="text-[10px] bg-red-500/20 text-red-400 px-2 py-1 rounded border border-red-500/20">ROOT</span>
            </div>

            <div id="adm-menu" class="grid grid-cols-1 gap-4">
                <button onclick="openAdmCinema()" class="bg-zinc-900/80 p-6 rounded-2xl border border-zinc-800 flex items-center gap-4 hover:bg-zinc-800 transition-colors group">
                    <div class="w-12 h-12 rounded-full bg-black flex items-center justify-center group-hover:scale-110 transition-transform">
                        <i data-lucide="clapperboard" class="text-white w-6 h-6"></i>
                    </div>
                    <div class="text-left">
                        <h3 class="text-white font-semibold">Programar Cinema</h3>
                        <p class="text-xs text-zinc-500">Gerenciar sessões e fila</p>
                    </div>
                </button>
            </div>

            <!-- ADMIN SUB-PAGE -->
            <div id="adm-cinema-manager" class="hidden fade-in pb-20">
                <button onclick="closeAdmCinema()" class="mb-6 flex items-center text-xs text-zinc-500 hover:text-white">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i> Voltar
                </button>

                <div class="bg-zinc-900/50 p-4 rounded-2xl border border-zinc-800 mb-8">
                    <h3 class="text-white font-medium mb-4 flex items-center gap-2">
                        <i data-lucide="plus-circle" class="w-4 h-4"></i> Novo Agendamento
                    </h3>
                    <div class="relative mb-4">
                        <input type="text" id="tmdb-search" class="glass-input w-full p-3 rounded-lg text-sm" placeholder="Buscar no TMDB (ex: Matrix)..." onkeyup="debounceSearch(this.value)">
                        <div id="tmdb-results" class="absolute top-full left-0 w-full bg-black border border-zinc-800 rounded-lg mt-1 max-h-48 overflow-y-auto z-50 hidden"></div>
                    </div>

                    <div id="film-form" class="hidden space-y-3 border-t border-zinc-800 pt-4">
                        <div class="flex gap-3">
                            <img id="form-poster" src="" class="w-16 h-24 object-cover rounded bg-zinc-800">
                            <div class="flex-1">
                                <input type="text" id="form-title" class="bg-transparent text-white font-bold w-full focus:outline-none mb-1" readonly>
                                <textarea id="form-overview" class="bg-transparent text-zinc-500 text-xs w-full h-16 resize-none focus:outline-none" readonly></textarea>
                            </div>
                        </div>
                        <div>
                            <label class="text-[10px] text-zinc-500 uppercase">Link MP4 (Direct URL)</label>
                            <input type="url" id="form-mp4" class="glass-input w-full p-2 rounded text-xs" placeholder="https://site.com/video.mp4">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="text-[10px] text-zinc-500 uppercase">Data</label>
                                <input type="date" id="form-date" class="glass-input w-full p-2 rounded text-xs">
                            </div>
                            <div>
                                <label class="text-[10px] text-zinc-500 uppercase">Hora</label>
                                <input type="time" id="form-time" class="glass-input w-full p-2 rounded text-xs">
                            </div>
                        </div>
                        <button onclick="scheduleFilm()" class="w-full bg-white text-black font-bold py-3 rounded-lg hover:bg-gray-200 mt-2">Agendar Sessão</button>
                    </div>
                </div>

                <h3 class="text-white font-medium mb-4 pl-1">Fila de Exibição</h3>
                <div id="schedule-list" class="space-y-3"></div>
            </div>
        </section>

    </main>

    <!-- NAVIGATION -->
    <nav class="fixed bottom-0 left-0 w-full z-50 nav-immersive" style="height: var(--nav-height);">
        <div class="max-w-md mx-auto flex justify-between items-center px-6 h-full pb-2">
            <button onclick="window.app.switchTab('inicio')" class="nav-btn active flex flex-col items-center gap-1 group w-10" id="nav-inicio">
                <i data-lucide="home" class="w-6 h-6 text-zinc-500 group-hover:text-zinc-300 transition-colors"></i>
                <span class="text-[9px] text-zinc-600 group-hover:text-zinc-400 uppercase">Início</span>
            </button>
            <button onclick="window.app.switchTab('busca')" class="nav-btn flex flex-col items-center gap-1 group w-10" id="nav-busca">
                <i data-lucide="search" class="w-6 h-6 text-zinc-500 group-hover:text-zinc-300 transition-colors"></i>
                <span class="text-[9px] text-zinc-600 group-hover:text-zinc-400 uppercase">Busca</span>
            </button>
            <button onclick="window.app.switchTab('cinema')" class="nav-btn flex flex-col items-center gap-1 group w-10" id="nav-cinema">
                <i data-lucide="film" class="w-6 h-6 text-zinc-500 group-hover:text-zinc-300 transition-colors"></i>
                <span class="text-[9px] text-zinc-600 group-hover:text-zinc-400 uppercase">Cinema</span>
            </button>
            <button onclick="window.app.switchTab('perfil')" class="nav-btn flex flex-col items-center gap-1 group w-10" id="nav-perfil">
                <i data-lucide="user" class="w-6 h-6 text-zinc-500 group-hover:text-zinc-300 transition-colors"></i>
                <span class="text-[9px] text-zinc-600 group-hover:text-zinc-400 uppercase">Perfil</span>
            </button>
            <button onclick="window.app.switchTab('adm')" class="nav-btn hidden flex-col items-center gap-1 group w-10 scale-in" id="nav-adm">
                <i data-lucide="shield-check" class="w-6 h-6 text-red-500/70 group-hover:text-red-500 transition-colors"></i>
                <span class="text-[9px] text-red-500/70 group-hover:text-red-500 uppercase">ADM</span>
            </button>
        </div>
    </nav>

    <!-- LOGIC MODULE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, deleteDoc, doc, serverTimestamp, where, limit } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        // --- CONFIG ---
        const TMDB_API_KEY = "d0f7e2c414b1efff7b000ae9b681ed1b"; 
        const APP_ID_PATH = "babygirl-ece17";

        const firebaseConfig = {
            apiKey: "AIzaSyBDaJleodtZHNAfRMh5ocznP85WO2qMB2A",
            authDomain: "babygirl-ece17.firebaseapp.com",
            projectId: "babygirl-ece17",
            storageBucket: "babygirl-ece17.firebasestorage.app",
            messagingSenderId: "437360012265",
            appId: "1:437360012265:web:2244a4684048ff1b18f978"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- STATE & UI REFS ---
        let currentUser = null;
        let searchTimeout = null;
        let currentFilmData = null;
        let activeFilmId = null;
        let syncInterval = null;

        const ui = {
            auth: {
                loading: document.getElementById('auth-loading'),
                formsContainer: document.getElementById('auth-forms'),
                profileContainer: document.getElementById('user-profile'),
                loginForm: document.getElementById('form-login'),
                registerForm: document.getElementById('form-register'),
            },
            profile: {
                img: document.getElementById('profile-img'),
                name: document.getElementById('profile-name'),
                uid: document.getElementById('profile-uid'),
            },
            inputs: {
                loginEmail: document.getElementById('login-email'),
                loginPass: document.getElementById('login-password'),
                regName: document.getElementById('reg-name'),
                regEmail: document.getElementById('reg-email'),
                regPass: document.getElementById('reg-password'),
                regFile: document.getElementById('reg-avatar')
            },
            admin: {
                modal: document.getElementById('admin-modal'),
                input: document.getElementById('admin-password'),
                navBtn: document.getElementById('nav-adm'),
                cinemaManager: document.getElementById('adm-cinema-manager'),
                menu: document.getElementById('adm-menu'),
                tmdbSearch: document.getElementById('tmdb-search'),
                tmdbResults: document.getElementById('tmdb-results'),
                form: document.getElementById('film-form'),
                formTitle: document.getElementById('form-title'),
                formOverview: document.getElementById('form-overview'),
                formPoster: document.getElementById('form-poster'),
                formMp4: document.getElementById('form-mp4'),
                formDate: document.getElementById('form-date'),
                formTime: document.getElementById('form-time'),
                scheduleList: document.getElementById('schedule-list')
            },
            cinema: {
                player: document.getElementById('cinema-player'),
                posterOverlay: document.getElementById('cinema-poster-overlay'),
                posterImg: document.getElementById('cinema-poster-img'),
                title: document.getElementById('now-playing-title'),
                soundOverlay: document.getElementById('sound-overlay'),
                chatContainer: document.getElementById('chat-messages'),
                chatInput: document.getElementById('chat-input'),
                modal: document.getElementById('movie-info-modal'),
                modalTitle: document.getElementById('modal-movie-title'),
                modalPoster: document.getElementById('modal-movie-poster'),
                modalOverview: document.getElementById('modal-movie-overview')
            }
        };

        // --- GLOBAL WINDOW FUNCTIONS ---
        window.app = {};

        // Navigation (Updated for new layout)
        window.app.switchTab = (tabName) => {
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('fade-in');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('admin-active');
            });

            const target = document.getElementById(`tab-${tabName}`);
            if(target) {
                target.classList.remove('hidden');
                // Adiciona fade-in exceto na cinema se ja estiver tocando
                setTimeout(() => target.classList.add('fade-in'), 10);
            }

            const navBtn = document.getElementById(`nav-${tabName}`);
            if(navBtn) {
                if (tabName === 'adm') navBtn.classList.add('admin-active');
                else navBtn.classList.add('active');
            }
            
            if(tabName === 'cinema') scrollToBottom();
        };

        window.togglePassword = (id) => {
            const input = document.getElementById(id);
            input.type = input.type === "password" ? "text" : "password";
        };
        window.toggleAuthMode = (mode) => {
            if (mode === 'register') {
                ui.auth.loginForm.classList.add('hidden');
                ui.auth.registerForm.classList.remove('hidden');
            } else {
                ui.auth.registerForm.classList.add('hidden');
                ui.auth.loginForm.classList.remove('hidden');
            }
        };
        window.copyUid = () => {
            navigator.clipboard.writeText(ui.profile.uid.innerText).then(() => showToast("UID copiado!"));
        };

        // Admin Access
        let logoTapCount = 0;
        let logoTapTimer;
        window.handleLogoClick = () => {
            clearTimeout(logoTapTimer);
            logoTapCount++;
            if (navigator.vibrate) navigator.vibrate(50);

            if (logoTapCount === 1) {
                logoTapTimer = setTimeout(() => { window.app.switchTab('inicio'); logoTapCount = 0; }, 400);
            } else if (logoTapCount >= 5) {
                logoTapCount = 0;
                ui.admin.modal.classList.remove('hidden');
                ui.admin.input.value = '';
                ui.admin.input.focus();
            } else {
                logoTapTimer = setTimeout(() => { logoTapCount = 0; }, 400);
            }
        };
        window.closeAdminModal = () => ui.admin.modal.classList.add('hidden');
        window.checkAdminAccess = () => {
            if (ui.admin.input.value === 'leoleo') {
                showToast("Admin Habilitado");
                ui.admin.modal.classList.add('hidden');
                ui.admin.navBtn.classList.remove('hidden');
                ui.admin.navBtn.classList.add('flex');
            } else {
                showToast("Senha Incorreta");
                ui.admin.input.value = '';
            }
        };

        window.openAdmCinema = () => {
            ui.admin.menu.classList.add('hidden');
            ui.admin.cinemaManager.classList.remove('hidden');
        };
        window.closeAdmCinema = () => {
            ui.admin.cinemaManager.classList.add('hidden');
            ui.admin.menu.classList.remove('hidden');
        };

        window.debounceSearch = (val) => {
            clearTimeout(searchTimeout);
            if(val.length < 3) {
                ui.admin.tmdbResults.classList.add('hidden');
                return;
            }
            searchTimeout = setTimeout(() => searchTMDB(val), 500);
        };

        async function searchTMDB(queryStr) {
            try {
                const res = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(queryStr)}&language=pt-BR`);
                const data = await res.json();
                renderTMDBResults(data.results || []);
            } catch (e) {
                console.error(e);
                showToast("Erro ao buscar no TMDB.");
            }
        }

        function renderTMDBResults(movies) {
            const container = ui.admin.tmdbResults;
            container.innerHTML = '';
            if(movies.length === 0) {
                container.classList.add('hidden');
                return;
            }
            container.classList.remove('hidden');
            
            movies.slice(0, 5).forEach(movie => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-3 p-3 hover:bg-zinc-900 cursor-pointer border-b border-zinc-900";
                div.innerHTML = `
                    <img src="${movie.poster_path ? 'https://image.tmdb.org/t/p/w92' + movie.poster_path : 'https://placehold.co/40x60'}" class="w-10 h-14 object-cover rounded">
                    <div>
                        <p class="text-sm text-white font-semibold line-clamp-1">${movie.title}</p>
                        <p class="text-xs text-zinc-500">${movie.release_date?.split('-')[0] || 'N/A'}</p>
                    </div>
                `;
                div.onclick = () => selectFilm(movie);
                container.appendChild(div);
            });
        }

        function selectFilm(movie) {
            currentFilmData = movie;
            ui.admin.tmdbResults.classList.add('hidden');
            ui.admin.tmdbSearch.value = '';
            
            ui.admin.form.classList.remove('hidden');
            ui.admin.formTitle.value = movie.title;
            ui.admin.formOverview.value = movie.overview;
            ui.admin.formPoster.src = movie.poster_path ? 'https://image.tmdb.org/t/p/w154' + movie.poster_path : 'https://placehold.co/100x150';
            
            const now = new Date();
            now.setMinutes(now.getMinutes() + 10);
            ui.admin.formDate.valueAsDate = now;
            ui.admin.formTime.value = now.toTimeString().substring(0,5);
        }

        window.scheduleFilm = async () => {
            if(!currentFilmData) return;
            const mp4 = ui.admin.formMp4.value;
            const dateVal = ui.admin.formDate.value;
            const timeVal = ui.admin.formTime.value;

            if(!mp4 || !dateVal || !timeVal) {
                showToast("Preencha todos os campos");
                return;
            }

            const startTime = new Date(`${dateVal}T${timeVal}`);
            const timestamp = startTime.getTime();

            try {
                await addDoc(collection(db, "artifacts", APP_ID_PATH, "schedule"), {
                    tmdbId: currentFilmData.id,
                    title: currentFilmData.title,
                    overview: currentFilmData.overview,
                    poster: currentFilmData.poster_path ? 'https://image.tmdb.org/t/p/w500' + currentFilmData.poster_path : '',
                    mp4Url: mp4,
                    startTime: timestamp,
                    createdAt: serverTimestamp()
                });
                showToast("Sessão Agendada!");
                ui.admin.form.classList.add('hidden');
                ui.admin.formMp4.value = '';
                currentFilmData = null;
            } catch (e) {
                console.error(e);
                showToast("Erro ao agendar.");
            }
        };

        window.deleteSchedule = async (id) => {
            if(confirm("Remover filme da fila?")) {
                await deleteDoc(doc(db, "artifacts", APP_ID_PATH, "schedule", id));
            }
        };

        function initCinemaSync() {
            const q = query(collection(db, "artifacts", APP_ID_PATH, "schedule"), orderBy("startTime", "asc"));
            onSnapshot(q, (snapshot) => {
                const schedule = [];
                const listContainer = ui.admin.scheduleList;
                listContainer.innerHTML = '';

                snapshot.forEach(doc => {
                    const data = doc.data();
                    schedule.push({ id: doc.id, ...data });
                    
                    const date = new Date(data.startTime);
                    const div = document.createElement('div');
                    div.className = "flex items-center gap-3 bg-zinc-900 p-2 rounded-lg border border-zinc-800";
                    div.innerHTML = `
                        <img src="${data.poster}" class="w-10 h-14 object-cover rounded">
                        <div class="flex-1 min-w-0">
                            <p class="text-white text-xs font-bold truncate">${data.title}</p>
                            <p class="text-[10px] text-zinc-500">${date.toLocaleString()}</p>
                        </div>
                        <button onclick="deleteSchedule('${doc.id}')" class="text-red-500 p-2"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    `;
                    listContainer.appendChild(div);
                });

                updatePlayback(schedule);
                if(syncInterval) clearInterval(syncInterval);
                syncInterval = setInterval(() => updatePlayback(schedule), 1000);
            });
        }

        function updatePlayback(schedule) {
            const now = Date.now();
            let activeFilm = null;
            const startedFilms = schedule.filter(f => f.startTime <= now);
            if (startedFilms.length > 0) {
                activeFilm = startedFilms[startedFilms.length - 1];
                // 3 horas de duração max
                if (now - activeFilm.startTime > (3 * 60 * 60 * 1000)) {
                    activeFilm = null;
                }
            }

            if (activeFilm) {
                const offsetSeconds = (now - activeFilm.startTime) / 1000;
                
                if (activeFilm.id !== activeFilmId) {
                    activeFilmId = activeFilm.id;
                    loadFilm(activeFilm, offsetSeconds);
                } else {
                    const player = ui.cinema.player;
                    if (Math.abs(player.currentTime - offsetSeconds) > 3) {
                        player.currentTime = offsetSeconds;
                    }
                    if (player.paused && !player.ended) {
                        player.play().catch(e => {
                            ui.cinema.soundOverlay.classList.remove('hidden');
                        });
                    }
                }
            } else {
                stopCinema();
            }
        }

        function loadFilm(film, startTime) {
            const player = ui.cinema.player;
            ui.cinema.title.innerText = film.title;
            ui.cinema.posterOverlay.classList.add('hidden');
            
            player.src = film.mp4Url;
            player.currentTime = startTime;
            player.volume = 0;
            player.muted = true; 
            
            player.play().then(() => {
                ui.cinema.soundOverlay.classList.remove('hidden');
            }).catch(e => {
                ui.cinema.soundOverlay.classList.remove('hidden');
            });

            ui.cinema.modalTitle.innerText = film.title;
            ui.cinema.modalPoster.src = film.poster;
            ui.cinema.modalOverview.innerText = film.overview;
        }

        function stopCinema() {
            activeFilmId = null;
            ui.cinema.player.pause();
            ui.cinema.player.src = "";
            ui.cinema.title.innerText = "Aguardando Sessão...";
            ui.cinema.posterOverlay.classList.remove('hidden');
            ui.cinema.soundOverlay.classList.add('hidden');
        }

        window.toggleMute = () => {
            const player = ui.cinema.player;
            player.muted = !player.muted;
            if(!player.muted) {
                player.volume = 1;
                ui.cinema.soundOverlay.classList.add('hidden');
            } else {
                ui.cinema.soundOverlay.classList.remove('hidden');
            }
        };

        window.openMovieInfo = () => {
            if(activeFilmId) ui.cinema.modal.classList.remove('hidden');
        };
        window.closeMovieInfo = () => ui.cinema.modal.classList.add('hidden');

        function initChat() {
            const yesterday = Date.now() - (24 * 60 * 60 * 1000);
            const q = query(
                collection(db, "artifacts", APP_ID_PATH, "chat"), 
                orderBy("timestamp", "asc")
            );

            onSnapshot(q, (snapshot) => {
                const chatContainer = ui.cinema.chatContainer;
                chatContainer.innerHTML = '';
                
                // Reaplica mensagem de sistema
                const sysMsg = document.createElement('div');
                sysMsg.className = "flex justify-center mb-4";
                sysMsg.innerHTML = '<span class="text-[9px] text-zinc-500 bg-zinc-900/80 px-3 py-1.5 rounded-full border border-zinc-800 shadow-sm">Chat ao vivo • Histórico de 24h</span>';
                chatContainer.appendChild(sysMsg);

                snapshot.forEach(doc => {
                    const data = doc.data();
                    if(data.timestamp > yesterday) {
                        renderMessage(data);
                    }
                });
                scrollToBottom();
            });
        }

        function renderMessage(msg) {
            const div = document.createElement('div');
            const isMe = currentUser && msg.uid === currentUser.uid;
            
            div.className = `flex gap-2 mb-3 items-end ${isMe ? 'flex-row-reverse' : ''}`;
            
            div.innerHTML = `
                <div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0 bg-zinc-800 border border-zinc-700 shadow-md">
                    <img src="${msg.avatar}" class="w-full h-full object-cover">
                </div>
                <div class="chat-bubble ${isMe ? 'bg-white/10 text-white border-white/20' : 'text-zinc-200'}">
                    <p class="text-[9px] font-bold ${isMe ? 'text-right' : ''} text-white/50 mb-0.5 tracking-wide uppercase">${msg.name}</p>
                    <p class="text-xs leading-relaxed font-light">${msg.text}</p>
                </div>
            `;
            ui.cinema.chatContainer.appendChild(div);
        }

        window.sendMessage = async () => {
            if (!currentUser) {
                showToast("Faça login para participar.");
                return;
            }
            const input = ui.cinema.chatInput;
            const text = input.value.trim();
            if (!text) return;

            input.value = '';
            
            try {
                await addDoc(collection(db, "artifacts", APP_ID_PATH, "chat"), {
                    text: text,
                    uid: currentUser.uid,
                    name: currentUser.displayName,
                    avatar: currentUser.photoURL,
                    timestamp: Date.now()
                });
            } catch (e) {
                console.error(e);
                showToast("Erro ao enviar mensagem.");
            }
        };
        
        ui.cinema.chatInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter') sendMessage();
        });

        function scrollToBottom() {
            const el = ui.cinema.chatContainer;
            el.scrollTop = el.scrollHeight;
        }

        function showToast(msg) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerText = msg;
            container.appendChild(toast);
            requestAnimationFrame(() => {
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            });
        }

        async function uploadToImgBB(file) {
            const formData = new FormData();
            formData.append("image", file);
            try {
                const response = await fetch("https://api.imgbb.com/1/upload?key=7ce206cded5b366ff1c2d1292e55b1c4", { method: "POST", body: formData });
                const data = await response.json();
                return data.success ? data.data.url : "https://i.ibb.co/5k03gX0/default-avatar.png";
            } catch (error) { return "https://i.ibb.co/5k03gX0/default-avatar.png"; }
        }

        onAuthStateChanged(auth, (user) => {
            ui.auth.loading.classList.add('hidden');
            currentUser = user;

            if (user) {
                ui.auth.formsContainer.classList.add('hidden');
                ui.auth.profileContainer.classList.remove('hidden');
                ui.auth.profileContainer.classList.add('flex');
                ui.profile.name.innerText = user.displayName || "Usuário";
                ui.profile.img.src = user.photoURL || "https://ui-avatars.com/api/?background=random&color=fff&name=User";
                ui.profile.uid.innerText = user.uid;
                
                ui.cinema.chatInput.placeholder = "Digite sua mensagem...";
                ui.cinema.chatInput.disabled = false;
            } else {
                ui.auth.profileContainer.classList.add('hidden');
                ui.auth.formsContainer.classList.remove('hidden');
                ui.auth.formsContainer.classList.add('flex');
                window.toggleAuthMode('login');

                ui.cinema.chatInput.placeholder = "Faça login para comentar";
                ui.cinema.chatInput.disabled = true;
            }
        });

        document.getElementById('btn-login').addEventListener('click', async () => {
            const email = ui.inputs.loginEmail.value, pass = ui.inputs.loginPass.value;
            if(!email || !pass) return showToast("Preencha tudo");
            try { await signInWithEmailAndPassword(auth, email, pass); showToast("Bem-vindo!"); } 
            catch { showToast("Erro no login"); }
        });

        document.getElementById('btn-register').addEventListener('click', async () => {
            const name = ui.inputs.regName.value, email = ui.inputs.regEmail.value, pass = ui.inputs.regPass.value, file = ui.inputs.regFile.files[0];
            if(!name || !email || !pass) return showToast("Preencha tudo");
            try {
                showToast("Criando conta...");
                let photo = "https://ui-avatars.com/api/?background=random&color=fff&name="+name;
                if(file) photo = await uploadToImgBB(file);
                const cred = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(cred.user, { displayName: name, photoURL: photo });
                showToast("Conta criada!");
            } catch { showToast("Erro no cadastro"); }
        });

        document.getElementById('btn-logout').addEventListener('click', () => signOut(auth));

        lucide.createIcons();
        initCinemaSync();
        initChat();

    </script>
</body>
</html>
